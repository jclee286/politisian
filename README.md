# 정치인 공화국 (Politisian Republic) - 개발 계획 및 작전 상황판

## 1. 프로젝트 비전 (The Vision)

'정치인 공화국'은 사용자들이 정치적 참여를 통해 보상을 받고, 커뮤니티의 합의를 통해 성장하는 탈중앙화된 블록체인 애플리케이션입니다. 사용자는 간편한 소셜 로그인을 통해 참여하고, 활동을 통해 코인을 획득하며, 공화국의 운영(예: 정치인 명부 등재)에 직접 기여할 수 있습니다.

### 핵심 기능 청사진

*   **최고의 사용자 경험:** 구글, 이메일 등 익숙한 소셜 로그인만으로 10초 안에 회원가입을 완료하며, 가입 즉시 사용자만이 제어할 수 있는 안전한 비수탁형(Non-Custodial) 블록체인 지갑이 자동으로 생성됩니다.
*   **가입 기념 코인 지급:** 최초 회원 정보(국가, 성별, 나이)를 입력하고, 등록된 정치인 중 3명을 선택하면 선택한 정치인 1명당 100개씩, 총 300개의 코인이 보상으로 지급됩니다.
*   **추천인 시스템 및 보상:** 친구 초대 링크를 통해 새로운 회원이 가입하면, 기존 회원은 추천인이 됩니다.
    *   **추천 활동 보상:** 추천인이 되어 새로운 회원이 1명씩 늘어날 때마다, 기존에 선택했던 3명 외의 새로운 정치인 1명을 추가로 선택할 권리가 생기며, 선택 시 100개의 코인을 추가로 획득합니다.
*   **시민 발의 정치인 등록:** 등록되지 않은 새로운 정치인을 회원이 직접 등록 발의할 수 있으며, 다른 회원들의 투표를 통해 과반수(예: 50% 이상)의 동의를 얻으면 해당 정치인은 자동으로 공식 명부에 등록되며 정치인 한명당 1000만개로 코인 발행량을 한정합니다.

## 2. 기술 아키텍처 (Architecture)

**전략: 단일 통합 서버 및 MPC 지갑 채택**

초기 접근 방식의 복잡성을 해결하고, 사용자 경험과 보안을 극대화하기 위해 아래의 아키텍처를 채택했습니다.

*   **사용자 인증 및 지갑 (Authentication & Wallet):** 전문적인 Wallet-as-a-Service(WaaS) 솔루션 **Privy**를 도입합니다.
    *   **MPC(다자간 컴퓨팅) 기술:** 사용자의 개인 키를 여러 조각으로 나누어 분산 저장하여, 완전한 키가 한 곳에 존재하지 않아 보안성이 매우 높습니다.
    *   **최고의 사용자 경험:** 사용자는 구글, 이메일 등 익숙한 소셜 로그인만으로 시드 구문 관리 없이 안전한 비수탁형(Non-Custodial) 지갑을 자동으로 소유하게 됩니다.
*   **프론트엔드 (Frontend):** 사용자와 직접 상호작용하는 웹 화면 (`profile.html` 등). Privy SDK와 연동하여 로그인 및 지갑 기능을 처리합니다. Vue, React 등 현대적인 프레임워크로 확장 가능합니다.
*   **통합 서버 (Integrated Server - 국가의 모든 기관):** 하나의 Go 바이너리(`politisian_server`) 안에 아래의 모든 기능이 포함되어 있습니다.
    *   **HTTP API 서버:** 로그인 인증 콜백, 프로필 저장 요청 등 외부 요청(Request)을 처리합니다.
    *   **ABCI 애플리케이션:** 블록체인의 핵심 로직(상태 관리, 트랜잭션 처리)을 담당합니다.
    *   **CometBFT 엔진:** 합의 알고리즘을 통해 블록을 생성하고 네트워크를 유지하는 블록체인 코어입니다. Go 애플리케이션 내부에서 직접 실행(in-process)되어 외부 통신 오버헤드 없이 매우 빠른 속도로 동작합니다.

## 3. 개발 로드맵 (Development Roadmap)

### Phase 1: 사용자 인증 고도화 및 핵심 기능 연동 (Advanced Auth & Core Integration)

-   **상태:** **진행 중 (In Progress)**
-   **전략 변경:** 초기 중앙화된 지갑 관리 방식에서 벗어나, 사용자 경험과 탈중앙성을 모두 극대화하기 위해 MPC 지갑 솔루션(Privy)을 도입하는 것으로 전략을 수정합니다.
-   **목표:** Privy를 연동하여 소셜 로그인 기반의 안전하고 편리한 지갑 생성 시스템을 구축하고, 이를 기존 백엔드 시스템과 완벽하게 통합합니다.
-   **세부 작전 계획:**
    -   [x] **통합 서버 아키텍처 설계** (CometBFT + ABCI + API 서버)
    -   [x] **CometBFT v0.38.12 엔진 내장**(in-process) 실행
    -   [x] **Go 기반 ABCI 애플리케이션** (`PolitisianApp`) 구현
    -   [ ] **Privy SDK 연동:** 프론트엔드에 Privy를 적용하여 소셜 로그인 기능 구현.
    -   [ ] **지갑 주소 기반 인증 시스템 연동:** Privy 로그인 성공 후 받은 지갑 주소를 백엔드의 `/api/auth/wallet/login` API로 전달하여 세션을 생성하는 로직 구현.
    -   [ ] **기존 프로필 저장 기능 연동:** 생성된 세션을 기반으로 사용자의 프로필(국가, 성별, 나이 등)을 블록체인에 저장하는 기능 테스트 및 안정화.
    -   [x] **블록체인 상태 조회** (`Query`) 기능 구현
    -   [ ] **최초 가입 보상 로직 재검토:** 새로운 인증 시스템에 맞게 최초 코인 지급 로직 점검 및 수정.

### Phase 2: 핵심 기능 확장 (Core Feature Expansion)

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 코인 지급 규칙을 구체화하고, 사용자 간 상호작용 및 거버넌스 기능을 추가합니다.
-   **세부 작전 계획:**
    -   [ ] 지지 정치인 선택에 따른 코인 지급 로직 구체화 (예: 3명 선택 시 300 코인)
    -   [ ] 친구 추천 시스템 및 보상 기능 구현
    -   [ ] 시민 주도 정치인 등록 시스템 설계 및 구현 (투표 기능 연계)
    -   [ ] 코인 전송 기능 구현
    -   [ ] 정치인별 1,000만개 코인 발행 한도 등 경제 모델 설정

### Phase 3: 프론트엔드 고도화 (The Public Square)

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 사용자가 블록체인과 상호작용할 수 있는 다양한 화면을 개발합니다.
-   **세부 작전 계획:**
    -   [x] 기본 프로필 설정 페이지 (`profile.html`) 개발
    -   [ ] UI/UX 고도화 (대시보드, 코인 전송, 정치인 목록 등)
    -   [ ] 블록체인 연동 개발 (지갑 정보 조회, 트랜잭션 서명 및 전송)


개발 작전 계획: 정치인 공화국
Phase 1: 정치인 선택 및 가입 보상 구현 (The Core Reward System)
현재 사용자는 가입만 하면 코인을 받습니다. 이것을 계획대로 '정치인을 선택'해야만 보상을 받는 시스템으로 업그레이드합니다. 이것이 가장 먼저 해야 할 일입니다.
1-1. 정치인 명부 작성: 먼저 코드 안에 정치인 A, 정치인 B, 정치인 C 와 같이 선택 가능한 초기 정치인 목록을 만듭니다. 각 정치인은 고유 이름과 남은 토큰 발행량(초기 1000만개)을 가집니다.
1-2. 프로필 페이지(Frontend) 업그레이드: profile.html의 정치인 선택 드롭다운 메뉴에, 우리가 만든 정치인 목록이 실제로 나타나도록 수정합니다.
1-3. 블록체인(Backend) 업그레이드:
사용자가 선택한 정치인 3명의 정보를 트랜잭션에 포함하여 블록체인에 기록합니다.
단순히 1000 코인을 주던 로직을, "선택된 각 정치인의 토큰 발행량을 100씩 차감하고, 사용자 지갑에 300 코인을 지급" 하는 로직으로 변경합니다.
Phase 2: 추천인 시스템 구현 (The Growth Engine)
핵심 보상 시스템이 완성되면, 사용자가 다른 사용자를 끌어들일 수 있는 추천인 시스템을 만듭니다.
2-1. 추천인 링크 생성: 각 사용자가 자신의 친구를 초대할 수 있는 고유한 링크(예: .../?ref=내지갑주소)를 발급합니다.
2-2. 추천인 관계 기록: 새로운 사용자가 이 링크를 통해 가입하면, 추천인의 지갑 주소를 새로운 사용자의 계정 정보에 함께 기록합니다.
2-3. 추천 보상 구현:
추천이 발생하면, 추천인의 '추가 정치인 선택권'이 1 증가했다는 것을 블록체인에 기록합니다.
추천인이 이 권리를 사용하여 새로운 정치인을 선택하고 100 코인을 받아가는 별도의 기능과 화면을 개발합니다.
Phase 3: 시민 발의 정치인 등록 (Decentralized Governance)
프로젝트의 핵심인 탈중앙화 거버넌스 기능을 구현합니다.
3-1. 정치인 등록 발의: 사용자가 새로운 정치인을 등록해달라고 제안(proposal)하는 기능과 트랜잭션을 만듭니다.
3-2. 투표 시스템: 다른 사용자들이 현재 발의된 안건 목록을 보고, 찬반 투표를 할 수 있는 기능과 트랜잭션을 만듭니다.
3-3. 자동 등록: 투표 결과, 찬성이 50표(또는 50%)를 넘으면 해당 정치인이 자동으로 공식 '정치인 명부'에 추가되고, 1000만개의 발행량을 갖도록 하는 로직을 블록체인에 구현합니다.

## 4. 배포 및 안정화 로드맵 (Deployment & Stabilization)

> 현재 프로젝트는 로컬 개발 및 수동 배포 단계에 있습니다. 안정적인 서비스 운영과 빠른 기능 업데이트를 위해, 아래의 로드맵에 따라 인프라를 고도화합니다.

### **Phase 1: 컨테이너화 및 환경 표준화 (Containerization)**

> '내 컴퓨터에서는 되는데 서버에서는 안 되는' 문제를 원천적으로 해결하고, 배포 환경을 표준화합니다.

-   **상태:** **진행 예정 (Pending)**
-   **목표:** Docker를 도입하여 애플리케이션과 실행 환경을 하나의 '컨테이너 이미지'로 패키징합니다. 이를 통해 개발, 테스트, 운영 환경의 완벽한 일관성을 확보합니다.
-   **세부 작전 계획:**
    -   [ ] **`Dockerfile` 작성:** Go 애플리케이션 빌드 및 실행 환경을 코드로 정의합니다.
    -   [ ] **`.dockerignore` 설정:** 불필요한 파일이 이미지에 포함되지 않도록 설정합니다.
    -   [ ] **`docker-compose.yml` 작성:** 로컬 환경에서 원클릭으로 애플리케이션 및 관련 서비스(향후 데이터베이스 등)를 실행할 수 있는 환경을 구축합니다. (블록체인 데이터 유지를 위한 `volumes` 설정 포함)
    -   [ ] **로컬 환경에서 컨테이너 실행 검증:** `docker-compose up` 명령어로 로컬에서 완벽하게 구동되는 것을 최종 확인합니다.

### **Phase 2: 클라우드 서버 배포 (Cloud Deployment)**

> 로컬에서 검증된 컨테이너 이미지를 실제 운영 서버(DigitalOcean)에 배포합니다.

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 최소한의 설정만으로 운영 서버에서 안정적으로 애플리케이션을 실행합니다.
-   **세부 작전 계획:**
    -   [ ] **DigitalOcean 서버에 Docker 및 Docker Compose 설치:** 서버를 컨테이너 실행 환경으로 준비합니다.
    -   [ ] **Git을 이용한 코드 배포:** GitHub 저장소에서 최신 코드를 서버로 `clone` 또는 `pull` 합니다.
    -   [ ] **서버에서 컨테이너 실행:** `docker-compose up -d` 명령어로 백그라운드에서 애플리케이션을 실행하고, 외부 접속(8080, 26657 포트)을 확인합니다.

### **Phase 3: 배포 자동화 (CI/CD Pipeline)**

> 개발자가 코드를 `push` 하는 것만으로 테스트, 빌드, 배포의 모든 과정이 자동으로 이루어지는 파이프라인을 구축합니다.

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 사람의 실수를 원천 차단하고, 빠르고 안정적인 업데이트가 가능한 완전 자동화 배포 환경을 구축합니다.
-   **세부 작전 계획:**
    -   [ ] **GitHub Actions 워크플로우 설계:** `main` 브랜치 `push` 시 자동으로 실행될 워크플로우(`.github/workflows/deploy.yml`)를 설계합니다.
    -   [ ] **워크플로우 구현 - CI (지속적 통합):**
        -   [ ] 코드 체크아웃 및 Docker 이미지 빌드
        -   [ ] 빌드된 이미지를 컨테이너 레지스트리(Docker Hub 또는 GitHub Container Registry)에 푸시
    -   [ ] **워크플로우 구현 - CD (지속적 배포):**
        -   [ ] SSH를 통해 DigitalOcean 서버에 안전하게 접속
        -   [ ] 컨테이너 레지스트리에서 최신 이미지를 내려받아(`pull`) 애플리케이션을 재시작(`docker-compose up -d`)
    -   [ ] **민감 정보 관리:** 서버 접속 정보(SSH Key) 등을 GitHub Secrets에 안전하게 등록하여 워크플로우에서 사용합니다.

## 5. 작전 진행 기록 (Progress Log)

*   **2025-08-07: 대규모 코드 리팩토링 및 안정성 강화**
    *   **코드 구조 개선 (Code Structure Improvement):** 서버(`server`) 및 애플리케이션(`app`) 로직을 기능별(인증, API 핸들러, 상태 관리, 블록체인 통신 등)로 독립된 파일로 분리하는 대규모 리팩토링을 성공적으로 완료했습니다.
    *   **유지보수성 및 확장성 확보:** 복잡하게 얽혀있던 코드 의존성을 정리하여 잠재적인 버그 발생 가능성을 크게 낮추고, 향후 새로운 기능을 빠르고 안전하게 개발할 수 있는 매우 견고하고 전문적인 코드 기반을 마련했습니다.
    *   **현재 해결 과제 (Current Challenge):**
        *   **문제 현상:** 신규 회원이 프로필 정보를 성공적으로 저장한 후, 예상되는 대시보드(`index.html`)가 아닌 로그인 페이지(`login.html`)로 이동하는 문제가 발생하고 있습니다.
        *   **추정 원인:** 프로필 저장 후 대시보드로 이동하여 데이터를 요청하는 과정에서, 브라우저가 `session_token` 쿠키를 서버로 전송하지 않는 '쿠키 분실' 현상이 발생하는 것으로 추정됩니다. 이로 인해 서버의 인증 미들웨어(`authMiddleware`)가 요청을 거부하고, 프론트엔드의 예외 처리 로직이 사용자를 로그인 페이지로 보내는 것으로 분석됩니다. 다음 목표는 이 현상의 근본 원인을 파악하고 해결하는 것입니다.

*   **2025-08-06: 통합 서버 아키텍처 전환 및 핵심 기능 완성**
    *   **전략 변경:** 기존의 분리된 ABCI 앱/API 서버 구조의 복잡성을 해결하기 위해, CometBFT 노드, ABCI 애플리케이션, API 서버를 하나의 Go 프로세스로 통합하는 **'단일 통합 서버'** 아키텍처로 과감하게 전환했습니다.
    *   **핵심 기능 구현 완료:** 구글 소셜 로그인, 신규 사용자 프로필(지갑 주소, 국가, 성별, 나이) 입력, 블록체인 상태 저장(in-memory), 그리고 저장된 데이터 조회까지의 완전한 기능 플로우를 구현했습니다.
    *   **최종 검증 완료:** `curl`을 이용해 실행 중인 블록체인 노드에 직접 쿼리를 보내, 사용자의 프로필 정보가 Base64로 인코딩되어 `value`에 정확히 저장된 것을 확인했습니다. `base64 --decode` 명령어로 원본 데이터를 복호화하여 **데이터의 무결성을 최종 증명**했습니다.
    *   **안정적 기반 확보:** 이로써 향후 코인 전송, 투표 등 추가 기능을 개발할 수 있는 매우 안정적이고 단순한 기술적 기반을 확보했습니다.

*   **2025-08-04: 시스템 재정비 및 코어 엔진 안정화 완료**
    *   **기술 스택 확정:** 높은 안정성과 검증된 성능을 고려하여 **CometBFT v0.38.12**를 컨센서스 엔진으로 확정하고, 그 위에 직접 통신하는 독립 실행형 ABCI 애플리케이션을 개발하기로 결정했습니다.
    *   **의존성 문제 해결:** `go.mod`의 `replace` 지시어 등을 활용하여 모든 의존성 문제를 해결하고, v0.38.12 버전에 완벽하게 호환되는 안정적인 빌드 환경을 구축했습니다.
    *   **블록체인 구동 확인:** 빌드된 애플리케이션을 CometBFT 노드와 성공적으로 연결하여, **블록체인 네트워크가 정상적으로 새로운 블록을 생성하고 있음을 로그를 통해 최종 확인**했습니다. 
