# 정치인 공화국 (Politisian Republic) - 개발 계획 및 작전 상황판

## 1. 프로젝트 비전 (The Vision)

'정치인 공화국'은 사용자들이 정치적 참여를 통해 보상을 받고, 커뮤니티의 합의를 통해 성장하는 탈중앙화된 블록체인 애플리케이션입니다. 사용자는 간편한 소셜 로그인을 통해 참여하고, 활동을 통해 코인을 획득하며, 공화국의 운영(예: 정치인 명부 등재)에 직접 기여할 수 있습니다.

### 핵심 기능 청사진

*   **최고의 사용자 경험:** 구글, 이메일 등 익숙한 소셜 로그인만으로 10초 안에 회원가입을 완료하며, 가입 즉시 사용자만이 제어할 수 있는 안전한 비수탁형(Non-Custodial) 블록체인 지갑이 자동으로 생성됩니다.
*   **가입 기념 코인 지급:** 최초 회원 정보(국가, 성별, 나이)를 입력하고, 등록된 정치인 중 3명을 선택하면 선택한 정치인 1명당 100개씩, 총 300개의 코인이 보상으로 지급됩니다.
*   **추천인 시스템 및 보상:** 친구 초대 링크를 통해 새로운 회원이 가입하면, 기존 회원은 추천인이 됩니다.
    *   **추천 활동 보상:** 추천인이 되어 새로운 회원이 1명씩 늘어날 때마다, 기존에 선택했던 3명 외의 새로운 정치인 1명을 추가로 선택할 권리가 생기며, 선택 시 100개의 코인을 추가로 획득합니다.
*   **시민 발의 정치인 등록:** 등록되지 않은 새로운 정치인을 회원이 직접 등록 발의할 수 있으며, 다른 회원들의 투표를 통해 과반수(예: 50% 이상)의 동의를 얻으면 해당 정치인은 자동으로 공식 명부에 등록되며 정치인 한명당 1000만개로 코인 발행량을 한정합니다.

## 2. 기술 아키텍처 (Architecture)

**전략: 단일 통합 서버 및 MPC 지갑 채택**

초기 접근 방식의 복잡성을 해결하고, 사용자 경험과 보안을 극대화하기 위해 아래의 아키텍처를 채택했습니다.

*   **사용자 인증 및 지갑 (Authentication & Wallet):** 전문적인 Wallet-as-a-Service(WaaS) 솔루션 **Privy**를 도입합니다.
    *   **MPC(다자간 컴퓨팅) 기술:** 사용자의 개인 키를 여러 조각으로 나누어 분산 저장하여, 완전한 키가 한 곳에 존재하지 않아 보안성이 매우 높습니다.
    *   **최고의 사용자 경험:** 사용자는 구글, 이메일 등 익숙한 소셜 로그인만으로 시드 구문 관리 없이 안전한 비수탁형(Non-Custodial) 지갑을 자동으로 소유하게 됩니다.
*   **프론트엔드 (Frontend):** 바닐라 HTML/JS 기반의 사용자 인터페이스. Privy SDK와 연동하여 로그인 및 지갑 기능을 처리하며, 향후 Vue, React 등 현대적인 프레임워크로 확장 가능합니다.
*   **통합 서버 (Integrated Server - 국가의 모든 기관):** 하나의 Go 바이너리(`politisian`) 안에 아래의 모든 기능이 포함되어 있습니다.
    *   **HTTP API 서버:** 로그인 인증, 프로필 저장 등 외부 요청(Request)을 처리하는 API 엔드포인트를 제공합니다.
    *   **ABCI 애플리케이션:** 블록체인의 핵심 로직(상태 관리, 트랜잭션 처리)을 담당합니다.
    *   **CometBFT 엔진:** 합의 알고리즘을 통해 블록을 생성하고 네트워크를 유지하는 블록체인 코어입니다. Go 애플리케이션 내부에서 직접 실행(in-process)되어 외부 통신 오버헤드 없이 매우 빠른 속도로 동작합니다.
*   **리버스 프록시 (Reverse Proxy):** **Nginx**를 사용하여 외부의 표준 HTTP(80) 요청을 내부에서 실행 중인 Go 애플리케이션(8080)으로 안전하게 전달합니다.

## 3. 개발 로드맵 (Development Roadmap)

### Phase 1: 사용자 인증 고도화 및 핵심 기능 연동 (Advanced Auth & Core Integration)

-   **상태:** **완료 (Completed)**
-   **전략:** 초기 중앙화된 지갑 관리 방식에서 벗어나, 사용자 경험과 탈중앙성을 모두 극대화하기 위해 MPC 지갑 솔루션(Privy)을 도입.
-   **달성 목표:** Privy를 연동하여 소셜 로그인 기반의 안전하고 편리한 지갑 생성 시스템을 구축하고, 이를 기존 백엔드 시스템과 완벽하게 통합 완료.
-   **세부 작전 계획:**
    -   [x] **통합 서버 아키텍처 설계** (CometBFT + ABCI + API 서버)
    -   [x] **CometBFT v0.38.12 엔진 내장**(in-process) 실행
    -   [x] **Go 기반 ABCI 애플리케이션** (`PoliticianApp`) 구현
    -   [x] **Privy SDK 연동:** 프론트엔드에 Privy를 적용하여 소셜 로그인 기능 구현.
    -   [x] **지갑 주소 기반 인증 시스템 연동:** Privy 로그인 성공 후 받은 지갑 주소를 백엔드의 `/api/auth/wallet/login` API로 전달하여 세션을 생성하는 로직 구현.
    -   [x] **기존 프로필 저장 기능 연동:** 생성된 세션을 기반으로 사용자의 프로필(국가, 성별, 나이 등)을 블록체인에 저장하는 기능 테스트 및 안정화.
    -   [x] **블록체인 상태 조회** (`Query`) 기능 구현
    -   [ ] **최초 가입 보상 로직 재검토:** 새로운 인증 시스템에 맞게 최초 코인 지급 로직 점검 및 수정.

### Phase 2: 핵심 기능 확장 (Core Feature Expansion)

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 코인 지급 규칙을 구체화하고, 사용자 간 상호작용 및 거버넌스 기능을 추가합니다.
-   **세부 작전 계획:**
    -   [ ] 지지 정치인 선택에 따른 코인 지급 로직 구체화 (예: 3명 선택 시 300 코인)
    -   [ ] 친구 추천 시스템 및 보상 기능 구현
    -   [ ] 시민 주도 정치인 등록 시스템 설계 및 구현 (투표 기능 연계)
    -   [ ] 코인 전송 기능 구현
    -   [ ] 정치인별 1,000만개 코인 발행 한도 등 경제 모델 설정

### Phase 3: 프론트엔드 고도화 (The Public Square)

-   **상태:** **진행 예정 (Pending)**
-   **목표:** 사용자가 블록체인과 상호작용할 수 있는 다양한 화면을 개발합니다.
-   **세부 작전 계획:**
    -   [x] 기본 프로필 설정 페이지 (`profile.html`) 개발
    -   [ ] UI/UX 고도화 (대시보드, 코인 전송, 정치인 목록 등)
    -   [ ] 블록체인 연동 개발 (지갑 정보 조회, 트랜잭션 서명 및 전송)


## 4. 배포 및 안정화 로드맵 (Deployment & Stabilization)

> 로컬 개발 단계를 넘어, 실제 운영을 위한 클라우드 배포 및 완전 자동화 파이프라인 구축을 완료했습니다.

### **Phase 1 & 2: 컨테이너화 및 클라우드 서버 배포 (Containerization & Cloud Deployment)**

-   **상태:** **완료 (Completed)**
-   **목표:** Docker를 통해 실행 환경을 표준화하고, DigitalOcean 클라우드 서버에 안정적으로 배포 완료.
-   **세부 작전 계획:**
    -   [x] **`Dockerfile` 작성:** Go 애플리케이션 빌드 및 실행 환경을 코드로 정의 완료.
    -   [x] **`docker-compose.yml` 작성:** `docker-compose up` 명령어로 애플리케이션을 원클릭으로 실행하는 환경 구축 완료.
    -   [x] **DigitalOcean 서버 준비:** Ubuntu 서버에 Git, Docker, Docker Compose, Nginx 등 핵심 운영 환경 구축 완료.
    -   [x] **서버 배포 및 실행:** Git을 통해 코드를 내려받고, Docker 컨테이너로 애플리케이션을 성공적으로 실행.

### **Phase 3: 배포 자동화 (CI/CD Pipeline)**

-   **상태:** **완료 (Completed)**
-   **목표:** `git push`만으로 모든 배포 과정이 자동으로 처리되는 CI/CD 파이프라인 구축 완료.
-   **세부 작전 계획:**
    -   [x] **GitHub Actions 워크플로우 구축:** `.github/workflows/deploy.yml` 파일을 통해 `main` 브랜치 `push` 이벤트를 감지하여 자동 배포 파이프라인 실행.
    -   [x] **자동화 스크립트 상세:**
        -   **보안 접속:** GitHub Secrets에 저장된 SSH 키(`DO_SSH_KEY`)를 사용하여 DigitalOcean 서버에 안전하게 자동 접속.
        -   **코드 업데이트:** Git 저장소의 최신 코드를 서버로 `pull`.
        -   **자동 재시작:** `docker-compose`를 사용하여 최신 코드로 Docker 이미지를 다시 빌드하고, 무중단에 가깝게 애플리케이션 컨테이너를 재시작.
    -   [x] **Nginx 연동:** 서버 부팅 시 자동으로 실행되는 Nginx가 외부 요청(port 80)을 처리하여 실행중인 앱(port 8080)으로 전달하는 리버스 프록시 역할 수행.

## 5. 작전 진행 기록 (Progress Log)

*   **2025-08-10: 클라우드 배포 자동화 및 프론트엔드 안정성 확보 (Cloud Deployment Automation & Frontend Stabilization)**
    *   **GitHub Actions CI/CD 파이프라인 완성:** `git push`만으로 코드를 서버에 자동 배포, 빌드, 재시작하는 완전 자동화 파이프라인(`.github/workflows/deploy.yml`)을 구축했습니다. SSH 키는 GitHub Secrets에 안전하게 보관하여 보안성을 확보했습니다.
    *   **서버 환경 구축 및 Nginx 연동:** DigitalOcean의 Ubuntu 서버에 Docker, Docker Compose 등 운영 환경을 구축하고, 80번 포트로 들어오는 요청을 Go 앱(8080 포트)으로 전달하는 Nginx 리버스 프록시 설정을 완료하여 `politisian.org` 도메인으로의 정상적인 서비스 접근을 구현했습니다.
    *   **프론트엔드 로딩 문제 해결:**
        *   **문제 현상:** `Privy` SDK 스크립트가 브라우저에서 로드되지 않아 로그인이 불가능한 치명적인 문제가 지속적으로 발생했습니다.
        *   **원인 분석:** Go 서버의 정적 파일 라우팅 오류, SDK 파일 손상, 브라우저의 외부 스크립트 차단 등 복합적인 원인을 디버깅했습니다.
        *   **최종 해결:** 수차례의 시도 끝에, 불안정한 로컬 파일 서빙 방식 대신 가장 표준적이고 안정적인 **공식 CDN에서 SDK를 직접 불러오도록** 최종 결정하여 문제를 해결했습니다. 또한 Go 서버의 라우팅 로직을 수정하여 정적 리소스(`*.js`)가 인증 로직을 타지 않도록 수정했습니다.
    *   **현재 상태:** 백엔드 블록체인 노드는 서버에서 안정적으로 블록을 생성 중이며, 프론트엔드는 정상적으로 로그인 기능을 수행할 수 있는 **완전한 배포 및 운영 상태**를 달성했습니다.

*   **2025-08-07: 대규모 코드 리팩토링 및 안정성 강화**
    *   **코드 구조 개선 (Code Structure Improvement):** 서버(`server`) 및 애플리케이션(`app`) 로직을 기능별(인증, API 핸들러, 상태 관리 등)로 독립된 파일로 분리하는 대규모 리팩토링을 성공적으로 완료했습니다.
    *   **유지보수성 및 확장성 확보:** 복잡하게 얽혀있던 코드 의존성을 정리하여 향후 새로운 기능을 빠르고 안전하게 개발할 수 있는 매우 견고하고 전문적인 코드 기반을 마련했습니다.

*   **2025-08-06: 통합 서버 아키텍처 전환 및 핵심 기능 완성**
    *   **전략 변경:** 기존의 분리된 ABCI 앱/API 서버 구조의 복잡성을 해결하기 위해, CometBFT 노드, ABCI 애플리케이션, API 서버를 하나의 Go 프로세스로 통합하는 **'단일 통합 서버'** 아키텍처로 과감하게 전환했습니다.
    *   **핵심 기능 구현 완료:** 소셜 로그인, 신규 사용자 프로필 입력, 블록체인 상태 저장, 그리고 저장된 데이터 조회까지의 완전한 기능 플로우를 구현했습니다.
    *   **데이터 무결성 최종 증명:** `curl`과 `base64` 명령어를 통해 블록체인에 저장된 사용자 데이터가 손상 없이 정확히 기록되었음을 최종 확인했습니다.

*   **2025-08-04: 시스템 재정비 및 코어 엔진 안정화 완료**
    *   **기술 스택 확정:** **CometBFT v0.38.12**를 컨센서스 엔진으로 확정하고 안정적인 빌드 환경을 구축했습니다.
    *   **블록체인 구동 확인:** 빌드된 애플리케이션을 CometBFT 노드와 성공적으로 연결하여, **블록체인 네트워크가 정상적으로 새로운 블록을 생성하고 있음을 로그를 통해 최종 확인**했습니다. 
