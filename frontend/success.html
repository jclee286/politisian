<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ê³µí™”êµ­ - í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .success-container {
            background: white;
            color: #333;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #4CAF50;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }
        .countdown {
            font-size: 3em;
            font-weight: bold;
            color: #4CAF50;
            margin: 30px 0;
        }
        .message {
            color: #666;
            margin: 20px 0;
            line-height: 1.6;
            font-size: 1.1em;
        }
        .progress-ring {
            width: 100px;
            height: 100px;
            margin: 20px auto;
        }
        .progress-ring circle {
            stroke: #4CAF50;
            stroke-width: 4;
            fill: transparent;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transform-origin: 50% 50%;
            transform: rotate(-90deg);
            animation: countdown 15s linear forwards;
        }
        @keyframes countdown {
            to {
                stroke-dashoffset: 0;
            }
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">ğŸ‰</div>
        <h1>í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!</h1>
        
        <svg class="progress-ring">
            <circle cx="50" cy="50" r="45" />
        </svg>
        
        <div class="countdown" id="countdown">15</div>
        
        <div class="message">
            ë¸”ë¡ì²´ì¸ì— í”„ë¡œí•„ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
            <strong>15ì´ˆ í›„</strong> ìë™ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        let timeLeft = 15;
        const countdownEl = document.getElementById('countdown');
        
        // ì¹´ìš´íŠ¸ë‹¤ìš´ ì—…ë°ì´íŠ¸
        const timer = setInterval(() => {
            timeLeft--;
            countdownEl.textContent = timeLeft;
            
            console.log(`â° ëŒ€ì‹œë³´ë“œ ì´ë™ê¹Œì§€ ${timeLeft}ì´ˆ ë‚¨ìŒ`);
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                countdownEl.textContent = 'ì´ë™ì¤‘...';
                
                console.log('ğŸš€ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ ì‹œì‘');
                
                // ì„¸ì…˜ê³¼ í”„ë¡œí•„ì´ ëª¨ë‘ ì¤€ë¹„ë  ë•Œê¹Œì§€ í™•ì¸
                checkSessionAndProfile();
            }
        }, 1000);
        
        // ì„¸ì…˜ê³¼ í”„ë¡œí•„ ìƒíƒœë¥¼ ì²´í¬í•˜ëŠ” í•¨ìˆ˜
        function checkSessionAndProfile(maxAttempts = 10, attempt = 1) {
            console.log(`ğŸ” ì„¸ì…˜ ë° í”„ë¡œí•„ ì²´í¬ ì‹œë„ #${attempt}/${maxAttempts}`);
            
            // ë¨¼ì € ì„¸ì…˜ ì²´í¬
            fetch('/api/user/session-info')
                .then(response => {
                    console.log('ğŸ“‹ ì„¸ì…˜ ì²´í¬ ì‘ë‹µ:', response.status);
                    if (!response.ok) {
                        throw new Error(`ì„¸ì…˜ ì²´í¬ ì‹¤íŒ¨: ${response.status}`);
                    }
                    return response.json();
                })
                .then(sessionData => {
                    console.log('âœ… ì„¸ì…˜ ë°ì´í„°:', sessionData);
                    
                    // ì„¸ì…˜ì´ ìœ íš¨í•˜ë©´ í”„ë¡œí•„ë„ ì²´í¬
                    return fetch('/api/user/profile');
                })
                .then(response => {
                    console.log('ğŸ“„ í”„ë¡œí•„ ì²´í¬ ì‘ë‹µ:', response.status);
                    if (response.ok) {
                        console.log('ğŸ‰ ì„¸ì…˜ê³¼ í”„ë¡œí•„ì´ ëª¨ë‘ ì¤€ë¹„ë¨, ê°„ë‹¨í•œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (ë””ë²„ê¹…ìš©)');
                        setTimeout(() => {
                            // ì¼ë‹¨ ê°„ë‹¨í•œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•´ì„œ ë¬¸ì œ ê²©ë¦¬
                            window.location.replace('/dashboard-simple.html');
                        }, 500);
                    } else if (response.status === 401) {
                        throw new Error('í”„ë¡œí•„ ì¸ì¦ ì‹¤íŒ¨');
                    } else {
                        throw new Error(`í”„ë¡œí•„ ì²´í¬ ì‹¤íŒ¨: ${response.status}`);
                    }
                })
                .catch(error => {
                    console.error(`âŒ ì²´í¬ ì‹¤íŒ¨ (ì‹œë„ ${attempt}):`, error);
                    
                    if (attempt < maxAttempts) {
                        console.log(`â³ 2ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„... (${attempt + 1}/${maxAttempts})`);
                        setTimeout(() => {
                            checkSessionAndProfile(maxAttempts, attempt + 1);
                        }, 2000);
                    } else {
                        console.error('ğŸš¨ ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ë„ë‹¬, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                        window.location.replace('/login.html');
                    }
                });
        }
        
        console.log('âœ… í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ í˜ì´ì§€ ë¡œë“œë¨');
        console.log('ğŸª í˜„ì¬ ì¿ í‚¤:', document.cookie);
    </script>
</body>
</html>