<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ë‚˜ì˜ ê³µí™”êµ­ - ëŒ€ì‹œë³´ë“œ</title>
    <!-- ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ (Tailwind ëŒ€ì²´) -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            display: none;
        }
        .header h1 {
            color: #333;
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .card h2 {
            color: #333;
            border-bottom: 2px solid #28a745;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .wallet-address {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
        }
        .politisian-list {
            list-style: none;
            padding: 0;
        }
        .politisian-list li {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .scrollable-politician-list {
            max-height: 400px; /* ì•½ 5ëª…ì˜ ì •ì¹˜ì¸ì´ ë³´ì´ëŠ” ë†’ì´ */
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 5px;
            background-color: #f9f9f9;
        }
        .scrollable-politician-list::-webkit-scrollbar {
            width: 8px;
        }
        .scrollable-politician-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .scrollable-politician-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        .scrollable-politician-list::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .loading {
            color: #888;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .button {
             padding: 10px 15px;
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
        }
        .propose-button { background-color: #17a2b8; }
        .propose-button:hover { background-color: #138496; }
        .vote-button {
            margin-left: 10px;
            padding: 5px 10px;
        }
        .approve { background-color: #28a745; }
        .reject { background-color: #dc3545; }
        .error-message {
            color: red;
            margin: 10px 0;
        }
        .success-message {
            color: green;
            margin: 10px 0;
        }
    </style>
    
</head>
<body>

    <div class="header">
        <!-- í—¤ë” ìˆ¨ê¹€ -->
        <button id="login-button" style="display: none;">ë¡œê·¸ì¸</button>
    </div>

    <div class="dashboard-container">
        <div class="card">
            <h2>ğŸ’° ë‚˜ì˜ ì§€ê°‘ & ë³´ìœ  ì½”ì¸</h2>
            
            <!-- PIN ì…ë ¥ ëª¨ë‹¬ -->
            <div id="pin-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 400px; margin: 20px;">
                    <h3 style="color: #333; margin-bottom: 20px;">ğŸ” ì§€ê°‘ ì ê¸ˆ í•´ì œ</h3>
                    <p style="color: #666; margin-bottom: 20px;">6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”</p>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                        <input type="number" class="pin-digit-unlock" maxlength="1" min="0" max="9" style="width: 40px; height: 40px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 18px;">
                    </div>
                    <div id="pin-error" style="color: #e74c3c; margin-bottom: 15px; font-size: 14px;"></div>
                    <button id="unlock-wallet-btn" onclick="unlockWallet()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">ì ê¸ˆ í•´ì œ</button>
                    <button onclick="closePinModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                </div>
            </div>

            <!-- ìŠ¤í…Œì´ë¸”ì½”ì¸ ì…ê¸ˆ ëª¨ë‹¬ -->
            <div id="deposit-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px; margin: 20px;">
                    <h3 style="color: #333; margin-bottom: 20px;">ğŸ’³ ìŠ¤í…Œì´ë¸”ì½”ì¸ ì…ê¸ˆ</h3>
                    <div id="deposit-address-section">
                        <p style="color: #666; margin-bottom: 15px;">ì•„ë˜ ì£¼ì†Œë¡œ USDT ë˜ëŠ” USDC(Polygon ë„¤íŠ¸ì›Œí¬)ë¥¼ ë³´ë‚´ì£¼ì„¸ìš”:</p>
                        <div id="deposit-address" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; word-break: break-all; margin-bottom: 15px; border: 1px solid #e9ecef;">
                            ì£¼ì†Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                        <button onclick="copyDepositAddress()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-bottom: 20px;">ğŸ“‹ ì£¼ì†Œ ë³µì‚¬</button>
                    </div>
                    
                    <form id="deposit-form" style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label>í† í° ì¢…ë¥˜:</label>
                            <select id="deposit-token-type" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                                <option value="USDT">ğŸ’° USDT</option>
                                <option value="USDC">ğŸ’ USDC</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>ì…ê¸ˆ ê¸ˆì•¡:</label>
                            <input type="number" id="deposit-amount" min="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>íŠ¸ëœì­ì…˜ í•´ì‹œ:</label>
                            <input type="text" id="deposit-txhash" placeholder="Polygon ë„¤íŠ¸ì›Œí¬ íŠ¸ëœì­ì…˜ í•´ì‹œ" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>PIN (6ìë¦¬):</label>
                            <input type="password" id="deposit-pin" maxlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">âœ… ì…ê¸ˆ í™•ì¸</button>
                            <button type="button" onclick="closeDepositModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    <div id="deposit-status" style="margin-top: 15px; font-size: 14px;"></div>
                </div>
            </div>

            <!-- ìŠ¤í…Œì´ë¸”ì½”ì¸ ì¶œê¸ˆ ëª¨ë‹¬ -->
            <div id="withdraw-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px; margin: 20px;">
                    <h3 style="color: #333; margin-bottom: 20px;">ğŸ’¸ ìŠ¤í…Œì´ë¸”ì½”ì¸ ì¶œê¸ˆ</h3>
                    <form id="withdraw-form" style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label>í† í° ì¢…ë¥˜:</label>
                            <select id="withdraw-token-type" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                                <option value="USDT">ğŸ’° USDT</option>
                                <option value="USDC">ğŸ’ USDC</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>ì¶œê¸ˆ ê¸ˆì•¡:</label>
                            <input type="number" id="withdraw-amount" min="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                            <small style="color: #666;">ì‚¬ìš© ê°€ëŠ¥í•œ ì”ì•¡: <span id="available-balance-display">0</span></small>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>ë°›ì„ ì£¼ì†Œ (Polygon ë„¤íŠ¸ì›Œí¬):</label>
                            <input type="text" id="withdraw-address" placeholder="0xë¡œ ì‹œì‘í•˜ëŠ” ì´ë”ë¦¬ì›€ í˜¸í™˜ ì£¼ì†Œ" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>PIN (6ìë¦¬):</label>
                            <input type="password" id="withdraw-pin" maxlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" style="background: #ffc107; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">ğŸ’¸ ì¶œê¸ˆ ì‹ ì²­</button>
                            <button type="button" onclick="closeWithdrawModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    <div id="withdraw-status" style="margin-top: 15px; font-size: 14px;"></div>
                </div>
            </div>

            <!-- ì´ˆê¸° ì½”ì¸ ë°›ê¸° ëª¨ë‹¬ -->
            <div id="claim-coins-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px; margin: 20px;">
                    <h3 style="color: #333; margin-bottom: 20px;">ğŸ ì´ˆê¸° ì½”ì¸ ë°›ê¸°</h3>
                    <p style="color: #666; margin-bottom: 20px;">íšŒì›ê°€ì… ì¶•í•˜ ì½”ì¸ì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ì´ì¬ëª…</span>
                            <span style="color: #28a745; font-weight: bold;">100 ì½”ì¸</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ìœ¤ì„ì—´</span>
                            <span style="color: #28a745; font-weight: bold;">100 ì½”ì¸</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ì´ë‚™ì—°</span>
                            <span style="color: #28a745; font-weight: bold;">100 ì½”ì¸</span>
                        </div>
                        <hr style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>ì´í•©</span>
                            <span style="color: #f39c12; font-size: 18px;">300 ì½”ì¸</span>
                        </div>
                    </div>
                    
                    <form id="claim-coins-form" style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label>PIN (6ìë¦¬):</label>
                            <input type="password" id="claim-pin" maxlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" style="background: #f39c12; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">ğŸ ì½”ì¸ ë°›ê¸°</button>
                            <button type="button" onclick="closeClaimCoinsModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    <div id="claim-coins-status" style="margin-top: 15px; font-size: 14px;"></div>
                </div>
            </div>

            <!-- í¬ë ˆë”§ ì‚¬ìš© ëª¨ë‹¬ -->
            <div id="credit-usage-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px; margin: 20px;">
                    <h3 style="color: #333; margin-bottom: 20px;">âœ¨ ì¶”ì²œ í¬ë ˆë”§ ì‚¬ìš©í•˜ê¸°</h3>
                    <p style="color: #666; margin-bottom: 20px;">í¬ë ˆë”§ 1ê°œë‹¹ ì •ì¹˜ì¸ 1ëª…ì„ ì¶”ê°€ ì„ íƒí•˜ê³  ì½”ì¸ 100ê°œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="font-size: 18px; font-weight: bold; color: #28a745;">
                            ë³´ìœ  í¬ë ˆë”§: <span id="modal-credits">0</span>ê°œ
                        </div>
                    </div>
                    
                    <form id="credit-usage-form" style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label>ì¶”ê°€ ì„ íƒí•  ì •ì¹˜ì¸:</label>
                            <select id="credit-politician-select" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                                <option value="">ì •ì¹˜ì¸ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>ì‚¬ìš©í•  í¬ë ˆë”§ ìˆ˜:</label>
                            <input type="number" id="credit-amount" min="1" max="1" value="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required readonly>
                            <small style="color: #666;">í˜„ì¬ëŠ” ì •ì¹˜ì¸ 1ëª…ë‹¹ í¬ë ˆë”§ 1ê°œê°€ í•„ìš”í•©ë‹ˆë‹¤</small>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>PIN (6ìë¦¬):</label>
                            <input type="password" id="credit-pin" maxlength="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;" required>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" style="background: #f39c12; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">âœ¨ í¬ë ˆë”§ ì‚¬ìš©í•˜ê¸°</button>
                            <button type="button" onclick="closeCreditUsageModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    <div id="credit-usage-status" style="margin-top: 15px; font-size: 14px;"></div>
                </div>
            </div>

            <!-- ì§€ê°‘ì´ ì ê²¨ìˆì„ ë•Œ í‘œì‹œ -->
            <div id="wallet-locked" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ”’</div>
                <h3 style="color: #666; margin-bottom: 15px;">ì§€ê°‘ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤</h3>
                <p style="color: #999; margin-bottom: 20px;">ì¤‘ìš”í•œ ê±°ë˜ë¥¼ ìœ„í•´ PINì„ ì…ë ¥í•˜ì„¸ìš”</p>
                <button onclick="showPinModal()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 16px;">ğŸ”‘ ì§€ê°‘ ì ê¸ˆ í•´ì œ</button>
            </div>

            <!-- ì§€ê°‘ì´ í•´ì œë˜ì—ˆì„ ë•Œ í‘œì‹œ -->
            <div id="wallet-unlocked">
                <div style="margin-bottom: 20px;">
                    <p><strong>ì§€ê°‘ ì£¼ì†Œ:</strong></p>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="wallet-address" class="wallet-address loading">
                            ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                        <button id="copy-wallet-btn" onclick="copyWalletAddress()" 
                                style="display: none; padding: 5px 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            ğŸ“‹ ë³µì‚¬
                        </button>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>ì´ ë³´ìœ  ì½”ì¸:</strong> <span id="total-coins" style="font-size: 1.3em; font-weight: bold; color: #2c3e50;">0ê°œ</span></p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                        <div style="background: #fff3cd; padding: 10px; border-radius: 6px; border: 1px solid #f39c12;">
                            <p style="margin: 0; font-weight: bold; color: #f39c12;">ğŸ’° USDT</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: bold;" id="tether-balance">0</p>
                            <small style="color: #666;">ì‚¬ìš©ê°€ëŠ¥: <span id="available-tether" style="color: #28a745;">0</span></small>
                        </div>
                        <div style="background: #d1ecf1; padding: 10px; border-radius: 6px; border: 1px solid #17a2b8;">
                            <p style="margin: 0; font-weight: bold; color: #17a2b8;">ğŸ’ USDC</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: bold;" id="usdc-balance">0</p>
                            <small style="color: #666;">ì‚¬ìš©ê°€ëŠ¥: <span id="available-usdc" style="color: #28a745;">0</span></small>
                        </div>
                    </div>
                </div>
                
                <hr style="margin: 20px 0;">
                
                <h3 style="margin-bottom: 15px;">ğŸ ì¶”ì²œ í¬ë ˆë”§</h3>
                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #28a745; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #28a745; margin-bottom: 5px;">
                        <span id="referral-credits">0</span> í¬ë ˆë”§
                    </div>
                    <small style="color: #666;">ê°€ì…ì‹œí‚¨ ì¹œêµ¬ ìˆ˜ì— ë”°ë¥¸ ë³´ìƒ</small>
                </div>
                
                <!-- ì¶”ì²œ ë§í¬ ê³µìœ  ì„¹ì…˜ -->
                <div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; text-align: center;">
                    <h4 style="margin: 0 0 10px 0; color: white;">ğŸ”— ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°</h4>
                    <p style="margin: 0 0 15px 0; font-size: 14px; opacity: 0.9;">ì¹œêµ¬ê°€ ì´ ë§í¬ë¡œ ê°€ì…í•˜ë©´ í¬ë ˆë”§ 1ê°œì”© ë°›ì•„ìš”!</p>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 6px; margin-bottom: 15px; position: relative;">
                        <input type="text" id="referral-link" readonly 
                               style="width: 100%; background: transparent; border: none; color: white; font-size: 14px; font-family: monospace; text-align: center; outline: none;" 
                               value="ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...">
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="copyReferralLink()" 
                                style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ“‹ ë³µì‚¬
                        </button>
                        <button onclick="shareReferralLink()" 
                                style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ“± ê³µìœ 
                        </button>
                    </div>
                </div>
                
                <!-- í¬ë ˆë”§ ì‚¬ìš© ì„¹ì…˜ -->
                <div id="credit-usage-section" style="margin-top: 15px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; display: none;">
                    <h4 style="margin: 0 0 10px 0; color: #d68910;">âœ¨ í¬ë ˆë”§ ì‚¬ìš©í•˜ê¸°</h4>
                    <p style="margin: 0 0 15px 0; font-size: 14px; color: #856404;">í¬ë ˆë”§ 1ê°œë‹¹ ì •ì¹˜ì¸ 1ëª…ì„ ì¶”ê°€ ì„ íƒí•˜ê³  ì½”ì¸ 100ê°œë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</p>
                    <button onclick="showCreditUsageModal()" 
                            style="background: #f39c12; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        ğŸ¯ í¬ë ˆë”§ ì‚¬ìš©í•˜ê¸°
                    </button>
                </div>
                
                <hr style="margin: 20px 0;">
                
                <h3 style="margin-bottom: 15px;">ğŸ›ï¸ ë³´ìœ  ì¤‘ì¸ ì •ì¹˜ì¸ ì½”ì¸</h3>
                <ul id="politician-coins-list" class="politisian-list">
                    <li class="loading">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
                </ul>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="showDepositModal()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px;">ğŸ’³ ì…ê¸ˆ</button>
                    <button onclick="showWithdrawModal()" style="background: #ffc107; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-right: 10px;">ğŸ’¸ ì¶œê¸ˆ</button>
                    <button onclick="lockWallet()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">ğŸ”’ ë³´ì•ˆ ì ê¸ˆ</button>
                </div>
            </div>
        </div>
        <div class="card">
            <h2>ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡</h2>
            <p>íˆ¬í‘œë¥¼ í†µí•´ ìŠ¹ì¸ëœ ëª¨ë“  ì •ì¹˜ì¸ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div class="search-container" style="margin-bottom: 15px;">
                <input type="text" id="search-politicians" placeholder="ì •ì¹˜ì¸ ì´ë¦„, ì§€ì—­êµ¬, ì •ë‹¹ìœ¼ë¡œ ê²€ìƒ‰..." 
                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
            </div>
            <div class="scrollable-politician-list">
                <ul id="registered-politicians-list" class="politisian-list" style="margin: 0;">
                    <li class="loading">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
                </ul>
            </div>
        </div>
        
        <!-- ê±°ë˜ ì‹œìŠ¤í…œ ì¹´ë“œ -->
        <div class="card">
            <h2>ğŸ“ˆ ì •ì¹˜ì¸ ì½”ì¸ ê±°ë˜</h2>
            
            <!-- ê°€ê²© ìˆœìœ„ -->
            <div style="margin-bottom: 20px;">
                <h3>ğŸ† ì¸ê¸° ìˆœìœ„ (ê°€ê²©ìˆœ)</h3>
                <div id="price-rankings" style="max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px;">
                    <div class="loading">ê°€ê²© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
            
            <!-- ê°„ë‹¨ ê±°ë˜ ì¸í„°í˜ì´ìŠ¤ -->
            <div style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
                <h3>ğŸ’± ë¹ ë¥¸ ê±°ë˜</h3>
                <form id="trade-form" style="display: grid; gap: 10px;">
                    <select id="politician-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">ì •ì¹˜ì¸ ì„ íƒ...</option>
                    </select>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <select id="trade-type" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="buy">ë§¤ìˆ˜ (êµ¬ë§¤)</option>
                            <option value="sell">ë§¤ë„ (íŒë§¤)</option>
                        </select>
                        <select id="currency-type" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="USDT">ğŸ’° USDT</option>
                            <option value="USDC">ğŸ’ USDC</option>
                        </select>
                    </div>
                    <input type="number" id="trade-quantity" placeholder="ìˆ˜ëŸ‰" min="1" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="number" id="trade-price" placeholder="ê°€ê²©" min="1" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 14px; color: #666;">
                        <span id="trade-summary">ì •ì¹˜ì¸ê³¼ ìˆ˜ëŸ‰ì„ ì„ íƒí•˜ì„¸ìš”</span>
                    </div>
                    <button type="submit" style="padding: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                        ğŸ“Š ì£¼ë¬¸ ë“±ë¡
                    </button>
                </form>
                <div id="trade-status" style="margin-top: 10px; font-size: 14px;"></div>
            </div>
            
            <!-- ë‚´ ì£¼ë¬¸ ëª©ë¡ -->
            <div style="border-top: 1px solid #e0e0e0; padding-top: 20px; margin-top: 20px;">
                <h3>ğŸ“‹ ë‚´ í™œì„± ì£¼ë¬¸</h3>
                <div id="my-orders" style="max-height: 150px; overflow-y: auto;">
                    <div class="loading">ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container" style="margin-top: 20px;">
        <div class="card">
            <h2>ìƒˆë¡œìš´ ì •ì¹˜ì¸ ë°œì˜</h2>
            <form id="propose-form">
                <div class="form-group">
                    <label for="name">ì´ë¦„</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="region">ì§€ì—­êµ¬ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="region" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬ ê°‘">
                </div>
                <div class="form-group">
                    <label for="party">ì†Œì†ì •ë‹¹</label>
                    <input type="text" id="party" required>
                </div>
                <div class="form-group">
                    <label for="intro-url">ì†Œê°œ URL (ì„ íƒì‚¬í•­)</label>
                    <input type="url" id="intro-url" placeholder="https://example.com/politician-profile">
                </div>
                <button type="submit" class="button propose-button">ë°œì˜í•˜ê¸°</button>
            </form>
            <p id="propose-status" style="height: 1em; color: green;"></p>
        </div>
        <div class="card">
            <h2>ì§„í–‰ì¤‘ì¸ ë°œì˜ ëª©ë¡</h2>
            <div class="scrollable-politician-list">
                <ul id="proposals-list" class="politisian-list" style="margin: 0;">
                    <li class="loading">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ  ì™„ì „í•œ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ë¡œë“œë¨ (v2.0)');
            
            // ì™„ì „íˆ ì•ˆì „í•œ ìš”ì†Œ ì°¸ì¡°
            const welcomeMessage = null; // ì™„ì „ ì œê±°
            const walletAddressElem = document.getElementById('wallet-address');
            const politicianCoinsListElem = document.getElementById('politician-coins-list');
            const totalCoinsElem = document.getElementById('total-coins');
            const loginButton = document.getElementById('login-button');
            const copyStatus = document.getElementById('copy-status');
            const proposalsListElem = document.getElementById('proposals-list');
            const registeredPoliticiansListElem = document.getElementById('registered-politicians-list');
            const searchPoliticiansInput = document.getElementById('search-politicians');
            const proposeForm = document.getElementById('propose-form');
            const proposeStatus = document.getElementById('propose-status');
            
            // ì „ì—­ ì •ì¹˜ì¸ ë°ì´í„° ì €ì¥
            let allPoliticiansData = {};

            console.log('ğŸª í˜„ì¬ ì¿ í‚¤:', document.cookie);

            // ì•ˆì „í•œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (ë¬´í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì§€)
            function loadUserProfile() {
                console.log('ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ ì‹œì‘');
                
                fetch('/api/user/profile')
                    .then(response => {
                        console.log('ğŸ“¡ í”„ë¡œí•„ API ì‘ë‹µ:', response.status);
                        
                        if (response.status === 401) {
                            console.log('ğŸ”’ 401 ì¸ì¦ ì˜¤ë¥˜ - ì„¸ì…˜ ì •ë³´ë¡œ ëŒ€ì²´');
                            loadSessionInfo();
                            return null;
                        }
                        
                        if (!response.ok) {
                            console.log('âŒ í”„ë¡œí•„ API ì‹¤íŒ¨, ì„¸ì…˜ ì •ë³´ë¡œ ëŒ€ì²´');
                            loadSessionInfo();
                            return null;
                        }
                        
                        return response.json();
                    })
                    .then(data => {
                        if (data) {
                            console.log('âœ… í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', data);
                            setWalletAddress(data.wallet || data.walletAddress || 'ì§€ê°‘ ì£¼ì†Œ ì—†ìŒ');
                            
                            // ë°±ì—… ë°ì´í„° ì €ì¥
                            saveBackupData(data.wallet || data.walletAddress, {
                                email: data.email,
                                address: data.address
                            });
                            
                            updateDashboardUI(data);
                            loadProposals(); // í”„ë¡œí•„ ë¡œë“œ ì„±ê³µ í›„ì—ë§Œ ì œì•ˆ ëª©ë¡ ë¡œë“œ
                            loadRegisteredPoliticians(); // ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ
                            loadTradingData(); // ê±°ë˜ ê´€ë ¨ ë°ì´í„° ë¡œë“œ
                        }
                    })
                    .catch(error => {
                        console.error('âŒ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:', error);
                        loadSessionInfo(); // ì‹¤íŒ¨ ì‹œ ì„¸ì…˜ ì •ë³´ë¡œ ëŒ€ì²´
                    });
            }

            // ì„¸ì…˜ ì •ë³´ë¡œ ëŒ€ì²´ ë¡œë“œ
            function loadSessionInfo() {
                console.log('ğŸ”‘ ì„¸ì…˜ ì •ë³´ë¡œ ëŒ€ì²´ ë¡œë“œ ì‹œë„');
                
                fetch('/api/user/session-info')
                    .then(response => {
                        console.log('ğŸ“¡ ì„¸ì…˜ API ì‘ë‹µ ìƒíƒœ:', response.status);
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error(`ì„¸ì…˜ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                    })
                    .then(sessionData => {
                        console.log('âœ… ì„¸ì…˜ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', sessionData);
                        
                        // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                        setWalletAddress(sessionData.walletAddress || 'ì§€ê°‘ ì£¼ì†Œ ì—†ìŒ');
                        
                        // ë°±ì—… ë°ì´í„° ì €ì¥
                        saveBackupData(sessionData.walletAddress, {
                            name: sessionData.name,
                            email: sessionData.email,
                            userId: sessionData.userId
                        });
                        
                        // ì„¸ì…˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¸°ë³¸ UI ì—…ë°ì´íŠ¸
                        // welcomeMessage.textContent = `${sessionData.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;
                        if (politicianCoinsListElem) {
                            politicianCoinsListElem.innerHTML = '<li>í”„ë¡œí•„ ì •ë³´ë¥¼ ì™„ì „íˆ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</li>';
                        }
                        
                        // ì„¸ì…˜ ì •ë³´ë¡œë„ ì œì•ˆ ëª©ë¡ ì‹œë„
                        setTimeout(() => {
                            loadProposals();
                            loadRegisteredPoliticians();
                        }, 2000);
                    })
                    .catch(error => {
                        console.error('âŒ ì„¸ì…˜ ì •ë³´ë„ ë¡œë“œ ì‹¤íŒ¨:', error);
                        handleCompleteFailure();
                    });
            }

            // ì™„ì „í•œ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ì „ëµ
            function handleCompleteFailure() {
                console.log('ğŸš¨ ì™„ì „í•œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ - ë³µêµ¬ ì‹œë„');
                
                // 1ë‹¨ê³„: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°±ì—… ë°ì´í„° í™•ì¸
                const backupWallet = localStorage.getItem('backup_wallet_address');
                const backupUserInfo = localStorage.getItem('backup_user_info');
                
                if (backupWallet) {
                    console.log('ğŸ’¾ ë¡œì»¬ ë°±ì—…ì—ì„œ ì§€ê°‘ ì£¼ì†Œ ë³µêµ¬');
                    setWalletAddress(backupWallet);
                    
                    if (backupUserInfo) {
                        try {
                            const userInfo = JSON.parse(backupUserInfo);
                            // welcomeMessage.textContent = `${userInfo.name}ë‹˜ (ë³µêµ¬ëœ ì„¸ì…˜)`;
                        } catch (e) {
                            console.log('ë°±ì—… ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì‹¤íŒ¨');
                        }
                    }
                    
                    showRecoveryMessage();
                    return;
                }
                
                // 2ë‹¨ê³„: ì„¸ì…˜ ë§Œë£Œë¡œ íŒë‹¨í•˜ê³  ì¬ë¡œê·¸ì¸ ìœ ë„
                setWalletAddress('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
                if (politicianCoinsListElem) {
                    politicianCoinsListElem.innerHTML = '<li style="color: #e74c3c;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</li>';
                }
                
                // ì¬ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
                showReloginPrompt();
            }
            
            // ë³µêµ¬ ë©”ì‹œì§€ í‘œì‹œ
            function showRecoveryMessage() {
                const recoveryMsg = document.createElement('div');
                recoveryMsg.style.cssText = `
                    position: fixed; top: 20px; right: 20px; 
                    background: #f39c12; color: white; 
                    padding: 15px 20px; border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 1000; font-size: 14px;
                `;
                recoveryMsg.innerHTML = `
                    âš ï¸ ë°±ì—… ë°ì´í„°ì—ì„œ ë³µêµ¬ë¨<br>
                    <small>ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤</small>
                `;
                document.body.appendChild(recoveryMsg);
                
                setTimeout(() => recoveryMsg.remove(), 10000);
            }
            
            // ì¬ë¡œê·¸ì¸ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
            function showReloginPrompt() {
                const reloginDiv = document.createElement('div');
                reloginDiv.style.cssText = `
                    position: fixed; top: 50%; left: 50%; 
                    transform: translate(-50%, -50%);
                    background: white; padding: 30px; 
                    border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    text-align: center; z-index: 2000;
                    border: 2px solid #e74c3c;
                `;
                reloginDiv.innerHTML = `
                    <h3 style="color: #e74c3c; margin-top: 0;">ğŸ”’ ì„¸ì…˜ ë§Œë£Œ</h3>
                    <p>ì•ˆì „ì„ ìœ„í•´ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”</p>
                    <button onclick="window.location.href='/login.html'" 
                            style="background: #e74c3c; color: white; border: none; 
                                   padding: 12px 24px; border-radius: 6px; 
                                   cursor: pointer; font-size: 16px;">
                        ë‹¤ì‹œ ë¡œê·¸ì¸
                    </button>
                    <br><br>
                    <button onclick="this.parentElement.remove()" 
                            style="background: #95a5a6; color: white; border: none; 
                                   padding: 8px 16px; border-radius: 4px; 
                                   cursor: pointer; font-size: 14px;">
                        ë‚˜ì¤‘ì—
                    </button>
                `;
                
                // ë°°ê²½ ì˜¤ë²„ë ˆì´
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.5); z-index: 1500;
                `;
                
                document.body.appendChild(overlay);
                document.body.appendChild(reloginDiv);
                
                // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
                overlay.onclick = () => {
                    overlay.remove();
                    reloginDiv.remove();
                };
            }
            
            // ë°±ì—… ë°ì´í„° ì €ì¥ (ë¡œê·¸ì¸ ì„±ê³µ ì‹œ í˜¸ì¶œ)
            function saveBackupData(walletAddress, userInfo) {
                localStorage.setItem('backup_wallet_address', walletAddress);
                localStorage.setItem('backup_user_info', JSON.stringify(userInfo));
                localStorage.setItem('backup_timestamp', Date.now().toString());
            }

            // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateDashboardUI(data) {
                try {
                    console.log('ğŸ¨ UI ì—…ë°ì´íŠ¸ ì‹œì‘');
                    console.log('í”„ë¡œí•„ ë°ì´í„° ì „ì²´:', data);
                    
                    // ì•ˆì „í•œ ìš”ì†Œ ì ‘ê·¼
                    if (walletAddressElem) {
                        setWalletAddress(data.wallet || 'ì£¼ì†Œ ì—†ìŒ');
                    }
                    

                    // ì´ ì½”ì¸ í‘œì‹œ ì—…ë°ì´íŠ¸
                    if (totalCoinsElem) {
                        const totalCoins = data.total_coins || data.balance || 0;
                        totalCoinsElem.textContent = `${totalCoins}ê°œ`;
                    }
                    
                    // USDT ì”ì•¡ ì—…ë°ì´íŠ¸
                    const tetherBalanceElem = document.getElementById('tether-balance');
                    const availableTetherElem = document.getElementById('available-tether');
                    if (tetherBalanceElem && availableTetherElem) {
                        const tetherBalance = data.usdt_balance || 0;
                        const frozenTether = (data.escrow_account && data.escrow_account.frozen_usdt_balance) || 0;
                        const availableTether = tetherBalance - frozenTether;
                        
                        tetherBalanceElem.textContent = `${tetherBalance}`;
                        availableTetherElem.textContent = `${availableTether}`;
                        
                        // ë™ê²°ëœ ê¸ˆì•¡ì´ ìˆìœ¼ë©´ ìƒ‰ìƒ ë³€ê²½
                        if (frozenTether > 0) {
                            availableTetherElem.style.color = '#ffc107';
                            availableTetherElem.title = `ì´ ${tetherBalance} USDT ì¤‘ ${frozenTether} USDT ë™ê²°ë¨`;
                        } else {
                            availableTetherElem.style.color = '#28a745';
                            availableTetherElem.title = '';
                        }
                    }
                    
                    // USDC ì”ì•¡ ì—…ë°ì´íŠ¸
                    const usdcBalanceElem = document.getElementById('usdc-balance');
                    const availableUsdcElem = document.getElementById('available-usdc');
                    if (usdcBalanceElem && availableUsdcElem) {
                        const usdcBalance = data.usdc_balance || 0;
                        const frozenUsdc = (data.escrow_account && data.escrow_account.frozen_usdc_balance) || 0;
                        const availableUsdc = usdcBalance - frozenUsdc;
                        
                        usdcBalanceElem.textContent = `${usdcBalance}`;
                        availableUsdcElem.textContent = `${availableUsdc}`;
                        
                        // ë™ê²°ëœ ê¸ˆì•¡ì´ ìˆìœ¼ë©´ ìƒ‰ìƒ ë³€ê²½
                        if (frozenUsdc > 0) {
                            availableUsdcElem.style.color = '#ffc107';
                            availableUsdcElem.title = `ì´ ${usdcBalance} USDC ì¤‘ ${frozenUsdc} USDC ë™ê²°ë¨`;
                        } else {
                            availableUsdcElem.style.color = '#28a745';
                            availableUsdcElem.title = '';
                        }
                    }

                    // ì¶”ì²œ í¬ë ˆë”§ í‘œì‹œ
                    const referralCreditsElem = document.getElementById('referral-credits');
                    if (referralCreditsElem) {
                        const credits = data.referral_credits || 0;
                        referralCreditsElem.textContent = credits;
                        console.log('ì¶”ì²œ í¬ë ˆë”§ ì—…ë°ì´íŠ¸:', credits);
                        
                        // í¬ë ˆë”§ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                        if (credits > 0) {
                            referralCreditsElem.parentElement.style.backgroundColor = '#d4edda';
                            referralCreditsElem.parentElement.style.borderColor = '#c3e6cb';
                            
                            // í¬ë ˆë”§ì´ ìˆìœ¼ë©´ ì‚¬ìš© ì„¹ì…˜ í‘œì‹œ
                            document.getElementById('credit-usage-section').style.display = 'block';
                        }
                    }
                    
                    // ì¶”ì²œ ë§í¬ ìƒì„±
                    generateReferralLink(data.wallet);

                    // ì •ì¹˜ì¸ë³„ ì½”ì¸ ë³´ìœ ëŸ‰ í‘œì‹œ
                    if (politicianCoinsListElem && data.politician_coins) {
                        console.log('ì •ì¹˜ì¸ë³„ ì½”ì¸ ë°ì´í„°:', data.politician_coins);
                        
                        const coinEntries = Object.entries(data.politician_coins);
                        
                        if (coinEntries.length > 0) {
                            politicianCoinsListElem.innerHTML = '';
                            coinEntries.forEach(([politicianId, coins]) => {
                                const li = document.createElement('li');
                                const politicianName = getPoliticianNameById(politicianId);
                                li.innerHTML = `${politicianName} <span style="float: right; color: #28a745; font-weight: bold;">${coins} ì½”ì¸</span>`;
                                politicianCoinsListElem.appendChild(li);
                            });
                        } else {
                            // ì½”ì¸ì´ ì—†ëŠ” ê²½ìš° ì´ˆê¸° ì½”ì¸ ë°›ê¸° ë²„íŠ¼ í‘œì‹œ
                            politicianCoinsListElem.innerHTML = `
                                <li style="text-align: center; padding: 20px;">
                                    <div style="color: #666; margin-bottom: 15px;">ë³´ìœ  ì¤‘ì¸ ì •ì¹˜ì¸ ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                                    <button onclick="showClaimCoinsModal()" 
                                            style="background: #f39c12; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                        ğŸ ì´ˆê¸° ì½”ì¸ ë°›ê¸°
                                    </button>
                                    <div style="font-size: 12px; color: #999; margin-top: 10px;">
                                        ì´ì¬ëª…, ìœ¤ì„ì—´, ì´ë‚™ì—° ê°ê° 100ê°œì”© ì´ 300ê°œ
                                    </div>
                                </li>
                            `;
                        }
                    } else if (politicianCoinsListElem) {
                        politicianCoinsListElem.innerHTML = '<li>ì½”ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>';
                    }
                    
                    // ë¡œê·¸ì¸ í›„ ìë™ìœ¼ë¡œ ì§€ê°‘ í•´ì œ
                    console.log('ğŸ”“ ë¡œê·¸ì¸ í›„ ìë™ ì§€ê°‘ í•´ì œ');
                    document.getElementById('wallet-locked').style.display = 'none';
                    document.getElementById('wallet-unlocked').style.display = 'block';
                    
                    console.log('âœ… UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ updateDashboardUI ì˜¤ë¥˜:', error);
                }
            }

            // ì œì•ˆ ëª©ë¡ ë¡œë“œ (ì•ˆì „í•œ ë°©ì‹)
            function loadProposals() {
                console.log('ğŸ“‹ ì œì•ˆ ëª©ë¡ ë¡œë“œ ì‹œì‘');
                
                fetch('/api/politisian/list')
                    .then(response => {
                        if (response.status === 401) {
                            console.log('ğŸ”’ ì œì•ˆ ëª©ë¡ì—ì„œ 401 ì˜¤ë¥˜ - ìŠ¤í‚µ');
                            proposalsListElem.innerHTML = '<li>ì œì•ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</li>';
                            return null;
                        }
                        if (!response.ok) {
                            throw new Error('ì œì•ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
                        }
                        return response.json();
                    })
                    .then(proposals => {
                        if (proposals) {
                            console.log('âœ… ì œì•ˆ ëª©ë¡ ë¡œë“œ ì„±ê³µ:', proposals);
                            console.log('proposals íƒ€ì…:', typeof proposals, 'keys:', Object.keys(proposals));
                            proposalsListElem.innerHTML = '';
                            
                            // proposalsê°€ ê°ì²´ì¸ì§€ í™•ì¸
                            if (typeof proposals !== 'object' || proposals === null) {
                                proposalsListElem.innerHTML = '<li>ì œì•ˆ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜</li>';
                                return;
                            }
                            
                            if (Object.keys(proposals).length === 0) {
                                proposalsListElem.innerHTML = '<li>ì§„í–‰ì¤‘ì¸ ë°œì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                                return;
                            }
                            
                            for (const id in proposals) {
                                const p = proposals[id];
                                console.log('ì œì•ˆ ë°ì´í„°:', id, p);
                                
                                // ì•ˆì „í•œ ë°ì´í„° ê²€ì¦
                                if (!p || typeof p !== 'object') {
                                    console.warn('Invalid proposal object:', p);
                                    continue;
                                }
                                
                                if (!p.politician || typeof p.politician !== 'object') {
                                    console.warn('Invalid politician data:', p.politician);
                                    continue;
                                }
                                
                                const li = document.createElement('li');
                                li.innerHTML = `
                                    <strong>${p.politician.name || 'ì´ë¦„ ì—†ìŒ'}</strong> (ì§€ì—­: ${p.politician.region || 'ë¯¸ì§€ì •'}, ì •ë‹¹: ${p.politician.party || 'ë¯¸ì§€ì •'})
                                    ${p.politician.intro_url ? '<br><a href="' + p.politician.intro_url + '" target="_blank">ì†Œê°œ í˜ì´ì§€</a>' : ''}
                                    <br>
                                    <span>ì°¬ì„±: ${p.yes_votes || 0} / ë°˜ëŒ€: ${p.no_votes || 0}</span>
                                    <button class="button vote-button approve" data-id="${p.id}" data-vote="true">ì°¬ì„±</button>
                                    <button class="button vote-button reject" data-id="${p.id}" data-vote="false">ë°˜ëŒ€</button>
                                `;
                                proposalsListElem.appendChild(li);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('âŒ ì œì•ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                        proposalsListElem.innerHTML = `<li>ì œì•ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}</li>`;
                    });
            }

            // ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ
            function loadRegisteredPoliticians() {
                console.log('ğŸ›ï¸ ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ ì‹œì‘');
                
                fetch('/api/politisian/registered')
                    .then(response => {
                        if (response.status === 401) {
                            console.log('ğŸ”’ ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ì—ì„œ 401 ì˜¤ë¥˜ - ìŠ¤í‚µ');
                            registeredPoliticiansListElem.innerHTML = '<li>ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</li>';
                            return null;
                        }
                        if (!response.ok) {
                            throw new Error('ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
                        }
                        return response.json();
                    })
                    .then(politicians => {
                        if (politicians) {
                            console.log('âœ… ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ ì„±ê³µ:', politicians);
                            
                            // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥
                            allPoliticiansData = politicians;
                            
                            // ëª©ë¡ í‘œì‹œ
                            displayPoliticians(politicians);
                            
                            // ê±°ë˜ìš© ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì˜µì…˜ ì—…ë°ì´íŠ¸
                            loadPoliticianSelectOptions();
                        }
                    })
                    .catch(error => {
                        console.error('âŒ ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                        registeredPoliticiansListElem.innerHTML = `<li>ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}</li>`;
                    });
            }

            // ì •ì¹˜ì¸ ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
            function displayPoliticians(politicians) {
                registeredPoliticiansListElem.innerHTML = '';
                
                if (Object.keys(politicians).length === 0) {
                    registeredPoliticiansListElem.innerHTML = '<li>ë“±ë¡ëœ ì •ì¹˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                    return;
                }
                
                for (const name in politicians) {
                    const politician = politicians[name];
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${politician.name || name}</strong>
                        <br>
                        <span style="color: #666;">ì§€ì—­: ${politician.region || 'ë¯¸ì§€ì •'} | ì •ë‹¹: ${politician.party || 'ë¯¸ì§€ì •'}</span>
                        ${politician.intro_url ? '<br><a href="' + politician.intro_url + '" target="_blank" style="color: #007bff;">ì†Œê°œ í˜ì´ì§€ â†’</a>' : ''}
                    `;
                    registeredPoliticiansListElem.appendChild(li);
                }
            }

            // ì •ì¹˜ì¸ ê²€ìƒ‰ í•¨ìˆ˜
            function searchPoliticians(searchTerm) {
                if (typeof allPoliticiansData === 'undefined' || !allPoliticiansData) {
                    console.log('ì •ì¹˜ì¸ ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (!searchTerm.trim()) {
                    displayPoliticians(allPoliticiansData);
                    return;
                }
                
                const filteredPoliticians = {};
                searchTerm = searchTerm.toLowerCase();
                
                for (const name in allPoliticiansData) {
                    const politician = allPoliticiansData[name];
                    const searchableText = `${politician.name || name} ${politician.region || ''} ${politician.party || ''}`.toLowerCase();
                    
                    if (searchableText.includes(searchTerm)) {
                        filteredPoliticians[name] = politician;
                    }
                }
                
                displayPoliticians(filteredPoliticians);
            }

            // ì •ì¹˜ì¸ IDë¡œ ì´ë¦„ì„ ì°¾ëŠ” í•¨ìˆ˜
            function getPoliticianNameById(politicianId) {
                if (typeof allPoliticiansData === 'undefined' || !allPoliticiansData || !politicianId) {
                    return politicianId || 'ì•Œ ìˆ˜ ì—†ëŠ” ì •ì¹˜ì¸';
                }
                
                // ë“±ë¡ëœ ì •ì¹˜ì¸ ë°ì´í„°ì—ì„œ ì°¾ê¸°
                if (allPoliticiansData[politicianId]) {
                    return allPoliticiansData[politicianId].name || politicianId;
                }
                
                // IDì—ì„œ ì´ë¦„ ë¶€ë¶„ ì¶”ì¶œ (ì˜ˆ: "ì´ì¬ëª…-ê²½ê¸° ê³„ì–‘êµ¬ ê°‘" -> "ì´ì¬ëª…")
                if (politicianId.includes('-')) {
                    return politicianId.split('-')[0];
                }
                
                return politicianId;
            }

            // ì§€ê°‘ ì£¼ì†Œ ì„¤ì • ë° ë³µì‚¬ ë²„íŠ¼ í‘œì‹œ í•¨ìˆ˜
            function setWalletAddress(address) {
                if (walletAddressElem) {
                    walletAddressElem.textContent = address;
                    // ìœ íš¨í•œ ì§€ê°‘ ì£¼ì†Œì¼ ë•Œë§Œ ë³µì‚¬ ë²„íŠ¼ í‘œì‹œ
                    const copyBtn = document.getElementById('copy-wallet-btn');
                    if (copyBtn && address && address !== 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...' && address !== 'ì˜¤ë¥˜' && address !== 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤' && address !== 'ì§€ê°‘ ì£¼ì†Œ ì—†ìŒ') {
                        copyBtn.style.display = 'inline-block';
                    }
                }
            }

            // ì§€ê°‘ ì£¼ì†Œ ë³µì‚¬ í•¨ìˆ˜
            function copyWalletAddress() {
                const address = walletAddressElem.textContent;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(address).then(() => {
                        const btn = document.getElementById('copy-wallet-btn');
                        const originalText = btn.textContent;
                        btn.textContent = 'âœ… ë³µì‚¬ë¨!';
                        btn.style.backgroundColor = '#28a745';
                        setTimeout(() => {
                            btn.textContent = originalText;
                            btn.style.backgroundColor = '#007bff';
                        }, 2000);
                    });
                } else {
                    // êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì‘
                    const textArea = document.createElement('textarea');
                    textArea.value = address;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('ì§€ê°‘ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            }

            // ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜
            function showError(message) {
                console.error('ğŸš¨ ì˜¤ë¥˜:', message);
                setWalletAddress('ì˜¤ë¥˜');
                if (politicianCoinsListElem) {
                    politicianCoinsListElem.innerHTML = `<li class="error-message">${message}</li>`;
                }
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            loginButton.addEventListener('click', () => {
                window.location.href = '/login.html';
            });

            // ì •ì¹˜ì¸ ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            searchPoliticiansInput.addEventListener('input', function(e) {
                searchPoliticians(e.target.value);
            });


            proposeForm.addEventListener('submit', function(event) {
                event.preventDefault();
                proposeStatus.textContent = 'ë°œì˜ ìš”ì²­ ì¤‘...';

                const politisianData = {
                    name: document.getElementById('name').value,
                    region: document.getElementById('region').value,
                    party: document.getElementById('party').value,
                    introUrl: document.getElementById('intro-url').value,
                };

                fetch('/api/politisian/propose', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(politisianData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => { throw new Error(text || 'ë°œì˜ ì‹¤íŒ¨') });
                    }
                    return response.text();
                })
                .then(data => {
                    proposeStatus.textContent = 'ë°œì˜ ì„±ê³µ!';
                    proposeForm.reset();
                    
                    // ì¦‰ì‹œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadProposals();
                    loadRegisteredPoliticians();
                    
                    // 1ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì§€ìš°ê¸°
                    setTimeout(() => {
                        proposeStatus.textContent = '';
                    }, 1000);
                })
                .catch(error => {
                    proposeStatus.textContent = `ì˜¤ë¥˜: ${error.message}`;
                });
            });

            proposalsListElem.addEventListener('click', function(event) {
                if (event.target.matches('.vote-button')) {
                    const proposalId = event.target.dataset.id;
                    const vote = event.target.dataset.vote === 'true';
                    
                    event.target.parentElement.querySelectorAll('.vote-button').forEach(btn => btn.disabled = true);

                    fetch(`/api/proposals/${proposalId}/vote`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ vote: vote })
                    })
                    .then(response => {
                         if (!response.ok) {
                            return response.text().then(text => { throw new Error(text || 'íˆ¬í‘œ ì‹¤íŒ¨') });
                        }
                        return response.text();
                    })
                    .then(data => {
                        // ì•Œë¦¼ì°½ ì—†ì´ ë°”ë¡œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        loadProposals();
                        loadRegisteredPoliticians();
                        
                        // íˆ¬í‘œ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ìƒíƒœ í‘œì‹œ
                        const allVoteButtons = event.target.parentElement.querySelectorAll('.vote-button');
                        allVoteButtons.forEach(btn => {
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                        });
                        
                        // íˆ¬í‘œ ì™„ë£Œ í‘œì‹œ
                        const statusSpan = document.createElement('span');
                        statusSpan.textContent = 'íˆ¬í‘œ ì™„ë£Œ âœ“';
                        statusSpan.style.color = '#28a745';
                        statusSpan.style.fontWeight = 'bold';
                        statusSpan.style.marginLeft = '10px';
                        event.target.parentElement.appendChild(statusSpan);
                    })
                    .catch(error => {
                        alert(`ì˜¤ë¥˜: ${error.message}`);
                        event.target.parentElement.querySelectorAll('.vote-button').forEach(btn => btn.disabled = false);
                    });
                }
            });

            // PIN ì…ë ¥ ìë™ í¬ì»¤ìŠ¤ ì´ë™ (ì ê¸ˆ í•´ì œìš©)
            const pinInputsUnlock = document.querySelectorAll('.pin-digit-unlock');
            pinInputsUnlock.forEach((input, index) => {
                input.addEventListener('input', function(e) {
                    if (e.target.value.length === 1 && index < pinInputsUnlock.length - 1) {
                        pinInputsUnlock[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
                        pinInputsUnlock[index - 1].focus();
                    }
                    if (e.key === 'Enter' && index === pinInputsUnlock.length - 1) {
                        unlockWallet();
                    }
                });
            });

            // ê±°ë˜ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const tradeForm = document.getElementById('trade-form');
            if (tradeForm) {
                tradeForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    placeTradeOrder();
                });
                
                // ê±°ë˜ ìš”ì•½ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
                const politicianSelect = document.getElementById('politician-select');
                const tradeTypeSelect = document.getElementById('trade-type');
                const currencyTypeSelect = document.getElementById('currency-type');
                const quantityInput = document.getElementById('trade-quantity');
                const priceInput = document.getElementById('trade-price');
                
                [politicianSelect, tradeTypeSelect, currencyTypeSelect, quantityInput, priceInput].forEach(element => {
                    if (element) {
                        element.addEventListener('change', updateTradeSummary);
                        element.addEventListener('input', updateTradeSummary);
                    }
                });
            }

            // ì´ˆê¸° ì½”ì¸ ë°›ê¸° í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const claimCoinsForm = document.getElementById('claim-coins-form');
            if (claimCoinsForm) {
                claimCoinsForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    processClaimCoins();
                });
            }

            // í¬ë ˆë”§ ì‚¬ìš© í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const creditUsageForm = document.getElementById('credit-usage-form');
            if (creditUsageForm) {
                creditUsageForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    processCreditUsage();
                });
            }

            // ì•ˆì „í•œ ë°ì´í„° ë¡œë“œ ì‹œì‘ (ì¦‰ì‹œ ë¡œë“œ)
            console.log('ğŸš€ ì¦‰ì‹œ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            loadUserProfile();
        });

        // ê±°ë˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadTradingData() {
            console.log('ğŸ“ˆ ê±°ë˜ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            loadPoliticianPrices();
            loadMyOrders();
            loadPoliticianSelectOptions();
        }

        function loadPoliticianPrices() {
            fetch('/api/trading/prices')
                .then(response => {
                    if (!response.ok) {
                        // 500 ì—ëŸ¬ì¸ ê²½ìš° ì¡°ìš©íˆ ì²˜ë¦¬
                        if (response.status === 500) {
                            console.log('âš ï¸ ê°€ê²© ì •ë³´ ì„œë¹„ìŠ¤ ì¼ì‹œ ë¶ˆê°€ (500 ì˜¤ë¥˜)');
                            return null;
                        }
                        throw new Error(`ê°€ê²© ì •ë³´ ë¡œë“œ ì‹¤íŒ¨ (${response.status})`);
                    }
                    return response.json();
                })
                .then(prices => {
                    if (prices) {
                        console.log('âœ… ê°€ê²© ì •ë³´ ë¡œë“œ ì„±ê³µ:', prices);
                        displayPriceRankings(prices);
                    } else {
                        console.log('ğŸ“Š ê°€ê²© ì •ë³´ ì—†ìŒ - ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ');
                        const priceElement = document.getElementById('price-rankings');
                        if (priceElement) {
                            priceElement.innerHTML = '<div style="color: #6c757d;">ê°€ê²© ì •ë³´ ì¤€ë¹„ ì¤‘...</div>';
                        }
                    }
                })
                .catch(error => {
                    console.log('âš ï¸ ê°€ê²© ì •ë³´ ë¡œë“œ ì‹¤íŒ¨ (ë¬´ì‹œë¨):', error.message);
                    // ê°€ê²© ì •ë³´ëŠ” ì„ íƒì  ê¸°ëŠ¥ì´ë¯€ë¡œ ì—ëŸ¬ë¥¼ ì¡°ìš©íˆ ì²˜ë¦¬
                    const priceElement = document.getElementById('price-rankings');
                    if (priceElement) {
                        priceElement.innerHTML = '<div style="color: #6c757d;">ê°€ê²© ì •ë³´ ì¼ì‹œ ë¶ˆê°€</div>';
                    }
                });
        }

        function displayPriceRankings(prices) {
            const rankingsElem = document.getElementById('price-rankings');
            if (!prices || prices.length === 0) {
                rankingsElem.innerHTML = '<div>ë“±ë¡ëœ ì •ì¹˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            rankingsElem.innerHTML = '';
            prices.forEach((price, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0; cursor: pointer;';
                div.innerHTML = `
                    <div>
                        <span style="font-weight: bold; color: #333;">${index + 1}. ${price.name}</span>
                        <br>
                        <small style="color: #666;">24h ê±°ë˜ëŸ‰: ${price.volume_24h || 0}</small>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: #2c3e50;">${price.current_price} USDT</div>
                        <small style="color: ${price.change_24h >= 0 ? '#28a745' : '#dc3545'};">
                            ${price.change_24h >= 0 ? '+' : ''}${price.change_24h || 0} (${((price.change_percent || 0) * 100).toFixed(2)}%)
                        </small>
                    </div>
                `;
                div.onclick = () => selectPoliticianForTrade(price.politician_id, price.name);
                rankingsElem.appendChild(div);
            });
        }

        function selectPoliticianForTrade(politicianId, name) {
            const selectElem = document.getElementById('politician-select');
            if (selectElem) {
                selectElem.value = politicianId;
                // ì„ íƒëœ ì •ì¹˜ì¸ì˜ í˜„ì¬ ê°€ê²©ì„ ê°€ê²© ì…ë ¥ë€ì— ìë™ ì…ë ¥
                fetch(`/api/trading/prices`)
                    .then(response => response.json())
                    .then(prices => {
                        const politician = prices.find(p => p.politician_id === politicianId);
                        if (politician) {
                            document.getElementById('trade-price').value = politician.current_price;
                        }
                    })
                    .catch(error => console.error('ê°€ê²© ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error));
            }
        }

        function loadPoliticianSelectOptions() {
            // ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ì„ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì¶”ê°€
            if (typeof allPoliticiansData !== 'undefined' && allPoliticiansData && Object.keys(allPoliticiansData).length > 0) {
                const selectElem = document.getElementById('politician-select');
                selectElem.innerHTML = '<option value="">ì •ì¹˜ì¸ ì„ íƒ...</option>';
                
                for (const id in allPoliticiansData) {
                    const politician = allPoliticiansData[id];
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = politician.name || id;
                    selectElem.appendChild(option);
                }
            }
        }

        function loadMyOrders() {
            fetch('/api/trading/my-orders')
                .then(response => {
                    if (!response.ok) throw new Error('ì£¼ë¬¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
                    return response.json();
                })
                .then(orders => {
                    console.log('âœ… ë‚´ ì£¼ë¬¸ ëª©ë¡ ë¡œë“œ ì„±ê³µ:', orders);
                    displayMyOrders(orders);
                })
                .catch(error => {
                    console.error('âŒ ë‚´ ì£¼ë¬¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('my-orders').innerHTML = '<div style="color: #e74c3c;">ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                });
        }

        function displayMyOrders(orders) {
            const ordersElem = document.getElementById('my-orders');
            if (!orders || orders.length === 0) {
                ordersElem.innerHTML = '<div>í™œì„± ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            ordersElem.innerHTML = '';
            orders.forEach(order => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 8px; background: #f9f9f9;';
                const currency = order.currency || 'USDT';
                const currencyIcon = currency === 'USDT' ? 'ğŸ’°' : 'ğŸ’';
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${getPoliticianNameById(order.politician_id)}</strong>
                            <span style="color: ${order.order_type === 'buy' ? '#28a745' : '#dc3545'}; font-weight: bold;">
                                ${order.order_type === 'buy' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}
                            </span>
                            <br>
                            <small>${order.quantity}ê°œ @ ${currencyIcon} ${order.price} ${currency}</small>
                            ${order.escrow_amount ? `<br><small style="color: #ffc107;">ğŸ”’ ${order.escrow_amount} ${order.order_type === 'buy' ? currency : 'ì½”ì¸'} ë™ê²°ë¨</small>` : ''}
                        </div>
                        <button onclick="cancelOrder('${order.id}')" 
                                style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            ì·¨ì†Œ
                        </button>
                    </div>
                `;
                ordersElem.appendChild(div);
            });
        }

        // ê±°ë˜ ìš”ì•½ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTradeSummary() {
            const politicianSelect = document.getElementById('politician-select');
            const tradeTypeSelect = document.getElementById('trade-type');
            const currencyTypeSelect = document.getElementById('currency-type');
            const quantityInput = document.getElementById('trade-quantity');
            const priceInput = document.getElementById('trade-price');
            const summaryElem = document.getElementById('trade-summary');
            
            if (!politicianSelect || !tradeTypeSelect || !currencyTypeSelect || !quantityInput || !priceInput || !summaryElem) {
                return;
            }
            
            const politician = politicianSelect.options[politicianSelect.selectedIndex]?.text || '';
            const tradeType = tradeTypeSelect.value;
            const currency = currencyTypeSelect.value;
            const quantity = parseInt(quantityInput.value) || 0;
            const price = parseInt(priceInput.value) || 0;
            
            if (!politician || politician === 'ì •ì¹˜ì¸ ì„ íƒ...' || !quantity || !price) {
                summaryElem.textContent = 'ì •ì¹˜ì¸ê³¼ ìˆ˜ëŸ‰ì„ ì„ íƒí•˜ì„¸ìš”';
                return;
            }
            
            const totalCost = quantity * price;
            const action = tradeType === 'buy' ? 'êµ¬ë§¤' : 'íŒë§¤';
            const currencyIcon = currency === 'USDT' ? 'ğŸ’°' : 'ğŸ’';
            
            if (tradeType === 'buy') {
                summaryElem.innerHTML = `${politician} ì½”ì¸ ${quantity}ê°œë¥¼ ${currencyIcon} ${totalCost} ${currency}ë¡œ ${action}`;
            } else {
                summaryElem.innerHTML = `${politician} ì½”ì¸ ${quantity}ê°œë¥¼ ${currencyIcon} ${totalCost} ${currency}ì— ${action}`;
            }
        }

        function placeTradeOrder() {
            const politicianId = document.getElementById('politician-select').value;
            const orderType = document.getElementById('trade-type').value;
            const currency = document.getElementById('currency-type').value;
            const quantity = parseInt(document.getElementById('trade-quantity').value);
            const price = parseInt(document.getElementById('trade-price').value);
            const statusElem = document.getElementById('trade-status');

            // ì…ë ¥ê°’ ê²€ì¦
            if (!politicianId) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì •ì¹˜ì¸ì„ ì„ íƒí•˜ì„¸ìš”.</span>';
                return;
            }
            if (!quantity || quantity <= 0) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }
            if (!price || price <= 0) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì˜¬ë°”ë¥¸ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            // ì”ì•¡ í™•ì¸
            if (orderType === 'buy') {
                const totalCost = quantity * price;
                let availableBalance = 0;
                let balanceText = '';
                
                if (currency === 'USDT') {
                    const availableTetherText = document.getElementById('available-tether').textContent;
                    availableBalance = parseInt(availableTetherText.replace(',', ''));
                    balanceText = `${totalCost} USDT`;
                } else {
                    const availableUsdcText = document.getElementById('available-usdc').textContent;
                    availableBalance = parseInt(availableUsdcText.replace(',', ''));
                    balanceText = `${totalCost} USDC`;
                }
                
                if (totalCost > availableBalance) {
                    statusElem.innerHTML = `<span style="color: #e74c3c;">ì‚¬ìš© ê°€ëŠ¥í•œ ${currency}ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${balanceText}, ì‚¬ìš©ê°€ëŠ¥: ${availableBalance} ${currency})</span>`;
                    return;
                }
            }

            // PIN ì…ë ¥ ë°›ê¸° (ê°„ë‹¨íˆ prompt ì‚¬ìš©)
            const pin = prompt('ê±°ë˜ ìŠ¹ì¸ì„ ìœ„í•´ 6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!pin || pin.length !== 6) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">6ìë¦¬ PINì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</span>';
                return;
            }

            statusElem.innerHTML = '<span style="color: #f39c12;">ì£¼ë¬¸ ë“±ë¡ ì¤‘...</span>';

            const orderData = {
                politician_id: politicianId,
                order_type: orderType,
                currency: currency,
                quantity: quantity,
                price: price,
                pin: pin
            };

            fetch('/api/trading/place-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.json();
            })
            .then(result => {
                console.log('âœ… ì£¼ë¬¸ ë“±ë¡ ì„±ê³µ:', result);
                statusElem.innerHTML = '<span style="color: #28a745;">ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</span>';
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('trade-form').reset();
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                loadTradingData();
                loadUserProfile(); // ì”ì•¡ ì—…ë°ì´íŠ¸
                
                setTimeout(() => {
                    statusElem.innerHTML = '';
                }, 3000);
            })
            .catch(error => {
                console.error('âŒ ì£¼ë¬¸ ë“±ë¡ ì‹¤íŒ¨:', error);
                statusElem.innerHTML = `<span style="color: #e74c3c;">ì£¼ë¬¸ ì‹¤íŒ¨: ${error.message}</span>`;
            });
        }

        function cancelOrder(orderId) {
            if (!confirm('ì •ë§ë¡œ ì´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            fetch(`/api/trading/cancel-order/${orderId}`, {
                method: 'POST'
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.json();
            })
            .then(result => {
                console.log('âœ… ì£¼ë¬¸ ì·¨ì†Œ ì„±ê³µ:', result);
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                loadMyOrders();
                loadUserProfile(); // ì”ì•¡ ì—…ë°ì´íŠ¸
            })
            .catch(error => {
                console.error('âŒ ì£¼ë¬¸ ì·¨ì†Œ ì‹¤íŒ¨:', error);
                alert(`ì£¼ë¬¸ ì·¨ì†Œ ì‹¤íŒ¨: ${error.message}`);
            });
        }

        // PIN ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showPinModal() {
            document.getElementById('pin-modal').style.display = 'flex';
            document.querySelectorAll('.pin-digit-unlock').forEach(input => input.value = '');
            document.querySelectorAll('.pin-digit-unlock')[0].focus();
            document.getElementById('pin-error').textContent = '';
        }

        function closePinModal() {
            document.getElementById('pin-modal').style.display = 'none';
        }

        function unlockWallet() {
            const pinInputs = document.querySelectorAll('.pin-digit-unlock');
            let pin = '';
            pinInputs.forEach(input => {
                pin += input.value;
            });

            if (pin.length !== 6) {
                document.getElementById('pin-error').textContent = '6ìë¦¬ ìˆ«ìë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.';
                return;
            }

            const unlockBtn = document.getElementById('unlock-wallet-btn');
            unlockBtn.disabled = true;
            unlockBtn.textContent = 'í™•ì¸ ì¤‘...';

            // PIN ê²€ì¦ API í˜¸ì¶œ (ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬)
            fetch('/api/auth/verify-pin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ pin: pin })
            })
            .then(response => {
                if (response.ok) {
                    // PIN ê²€ì¦ ì„±ê³µ
                    document.getElementById('wallet-locked').style.display = 'none';
                    document.getElementById('wallet-unlocked').style.display = 'block';
                    closePinModal();
                    
                    // ì§€ê°‘ ë°ì´í„° ë¡œë“œ
                    loadWalletData();
                } else {
                    throw new Error('ì˜ëª»ëœ PINì…ë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('PIN ê²€ì¦ ì‹¤íŒ¨:', error);
                document.getElementById('pin-error').textContent = error.message || 'ì˜ëª»ëœ PINì…ë‹ˆë‹¤.';
                unlockBtn.disabled = false;
                unlockBtn.textContent = 'ì ê¸ˆ í•´ì œ';
            });
        }

        function lockWallet() {
            document.getElementById('wallet-locked').style.display = 'block';
            document.getElementById('wallet-unlocked').style.display = 'none';
            
            // ì§€ê°‘ ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('wallet-address').textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            document.getElementById('total-coins').textContent = '0ê°œ';
            document.getElementById('politician-coins-list').innerHTML = '<li class="loading">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>';
        }

        function loadWalletData() {
            // ê¸°ì¡´ì˜ í”„ë¡œí•„ ë¡œë“œ í•¨ìˆ˜ ì¬ì‚¬ìš©
            loadUserProfile();
        }

        // ì…ê¸ˆ/ì¶œê¸ˆ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showDepositModal() {
            document.getElementById('deposit-modal').style.display = 'flex';
            loadDepositAddress();
            document.getElementById('deposit-form').reset();
            document.getElementById('deposit-status').innerHTML = '';
        }

        function closeDepositModal() {
            document.getElementById('deposit-modal').style.display = 'none';
        }

        function showWithdrawModal() {
            document.getElementById('withdraw-modal').style.display = 'flex';
            document.getElementById('withdraw-form').reset();
            document.getElementById('withdraw-status').innerHTML = '';
            
            // í† í° íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const tokenTypeSelect = document.getElementById('withdraw-token-type');
            if (tokenTypeSelect) {
                updateAvailableBalance();
                tokenTypeSelect.addEventListener('change', updateAvailableBalance);
            }
        }
        
        function updateAvailableBalance() {
            const tokenType = document.getElementById('withdraw-token-type').value;
            const balanceDisplay = document.getElementById('available-balance-display');
            
            if (tokenType === 'USDT') {
                const availableTetherText = document.getElementById('available-tether').textContent;
                balanceDisplay.textContent = `${availableTetherText} USDT`;
            } else {
                const availableUsdcText = document.getElementById('available-usdc').textContent;
                balanceDisplay.textContent = `${availableUsdcText} USDC`;
            }
        }

        function closeWithdrawModal() {
            document.getElementById('withdraw-modal').style.display = 'none';
        }

        function loadDepositAddress() {
            fetch('/api/wallet/address')
                .then(response => {
                    if (!response.ok) throw new Error('ì…ê¸ˆ ì£¼ì†Œ ì¡°íšŒ ì‹¤íŒ¨');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('deposit-address').textContent = data.deposit_address;
                })
                .catch(error => {
                    console.error('ì…ê¸ˆ ì£¼ì†Œ ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('deposit-address').textContent = 'ì£¼ì†Œ ë¡œë“œ ì‹¤íŒ¨';
                });
        }

        function copyDepositAddress() {
            const address = document.getElementById('deposit-address').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(address).then(() => {
                    alert('ì…ê¸ˆ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            } else {
                // êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì‘
                const textArea = document.createElement('textarea');
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('ì…ê¸ˆ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ì…ê¸ˆ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const depositForm = document.getElementById('deposit-form');
            if (depositForm) {
                depositForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    processDeposit();
                });
            }

            const withdrawForm = document.getElementById('withdraw-form');
            if (withdrawForm) {
                withdrawForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    processWithdraw();
                });
            }
        });

        function processDeposit() {
            const tokenType = document.getElementById('deposit-token-type').value;
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const txHash = document.getElementById('deposit-txhash').value;
            const pin = document.getElementById('deposit-pin').value;
            const statusElem = document.getElementById('deposit-status');

            if (!tokenType) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">í† í° ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</span>';
                return;
            }

            if (!amount || amount <= 0) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            if (!txHash) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">íŠ¸ëœì­ì…˜ í•´ì‹œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            if (!pin || pin.length !== 6) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            statusElem.innerHTML = `<span style="color: #f39c12;">${tokenType} ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...</span>`;

            const depositData = {
                amount: amount,
                token_type: tokenType,
                tx_hash: txHash,
                from_address: document.getElementById('deposit-address').textContent,
                pin: pin
            };

            fetch('/api/wallet/deposit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(depositData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.json();
            })
            .then(result => {
                console.log('âœ… ì…ê¸ˆ ì„±ê³µ:', result);
                statusElem.innerHTML = '<span style="color: #28a745;">ì…ê¸ˆì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!</span>';
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('deposit-form').reset();
                
                // ì”ì•¡ ì—…ë°ì´íŠ¸
                loadUserProfile();
                
                setTimeout(() => {
                    closeDepositModal();
                }, 2000);
            })
            .catch(error => {
                console.error('âŒ ì…ê¸ˆ ì‹¤íŒ¨:', error);
                statusElem.innerHTML = `<span style="color: #e74c3c;">ì…ê¸ˆ ì‹¤íŒ¨: ${error.message}</span>`;
            });
        }

        function processWithdraw() {
            const tokenType = document.getElementById('withdraw-token-type').value;
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            const toAddress = document.getElementById('withdraw-address').value;
            const pin = document.getElementById('withdraw-pin').value;
            const statusElem = document.getElementById('withdraw-status');

            if (!tokenType) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">í† í° ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</span>';
                return;
            }

            if (!amount || amount <= 0) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            if (!toAddress) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì¶œê¸ˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            if (!pin || pin.length !== 6) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            // ì”ì•¡ í™•ì¸
            let availableBalance = 0;
            if (tokenType === 'USDT') {
                const availableTetherText = document.getElementById('available-tether').textContent;
                availableBalance = parseInt(availableTetherText.replace(',', ''));
            } else {
                const availableUsdcText = document.getElementById('available-usdc').textContent;
                availableBalance = parseInt(availableUsdcText.replace(',', ''));
            }
            
            if (amount > availableBalance) {
                statusElem.innerHTML = `<span style="color: #e74c3c;">ì‚¬ìš© ê°€ëŠ¥í•œ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ìš”ì²­: ${amount} ${tokenType}, ì‚¬ìš©ê°€ëŠ¥: ${availableBalance} ${tokenType})</span>`;
                return;
            }

            statusElem.innerHTML = `<span style="color: #f39c12;">${tokenType} ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘...</span>`;

            const withdrawData = {
                amount: amount,
                token_type: tokenType,
                to_address: toAddress,
                pin: pin
            };

            fetch('/api/wallet/withdraw', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(withdrawData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.json();
            })
            .then(result => {
                console.log('âœ… ì¶œê¸ˆ ì„±ê³µ:', result);
                statusElem.innerHTML = '<span style="color: #28a745;">ì¶œê¸ˆì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!</span>';
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('withdraw-form').reset();
                
                // ì”ì•¡ ì—…ë°ì´íŠ¸
                loadUserProfile();
                
                setTimeout(() => {
                    closeWithdrawModal();
                }, 2000);
            })
            .catch(error => {
                console.error('âŒ ì¶œê¸ˆ ì‹¤íŒ¨:', error);
                statusElem.innerHTML = `<span style="color: #e74c3c;">ì¶œê¸ˆ ì‹¤íŒ¨: ${error.message}</span>`;
            });
        }

        // ì¶”ì²œ ë§í¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function generateReferralLink(walletAddress) {
            if (!walletAddress) {
                console.log('ì§€ê°‘ ì£¼ì†Œê°€ ì—†ì–´ì„œ ì¶”ì²œ ë§í¬ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const baseUrl = window.location.origin;
            const referralLink = `${baseUrl}/signup.html?ref=${walletAddress}`;
            
            const linkInput = document.getElementById('referral-link');
            if (linkInput) {
                linkInput.value = referralLink;
            }
            
            console.log('ì¶”ì²œ ë§í¬ ìƒì„±ë¨:', referralLink);
        }

        function copyReferralLink() {
            const linkInput = document.getElementById('referral-link');
            const link = linkInput.value;
            
            if (link === 'ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...') {
                alert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(link).then(() => {
                    showToast('ì¶”ì²œ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
                }).catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    fallbackCopy(link);
                });
            } else {
                fallbackCopy(link);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('ì¶”ì²œ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
            } catch (err) {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ì§ì ‘ ì„ íƒí•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
            document.body.removeChild(textArea);
        }

        function shareReferralLink() {
            const linkInput = document.getElementById('referral-link');
            const link = linkInput.value;
            
            if (link === 'ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...') {
                alert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const shareText = `ğŸ›ï¸ ë‚˜ì˜ ê³µí™”êµ­ì—ì„œ ì •ì¹˜ì¸ ì½”ì¸ì„ ë°›ì•„ë³´ì„¸ìš”!\n\nì •ì¹˜ì¸ì„ ì„ íƒí•˜ê³  ë¬´ë£Œ ì½”ì¸ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”.\n\n${link}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ğŸ›ï¸ ë‚˜ì˜ ê³µí™”êµ­ - ì¹œêµ¬ ì´ˆëŒ€',
                    text: shareText,
                    url: link
                }).then(() => {
                    console.log('ê³µìœ  ì„±ê³µ');
                }).catch(err => {
                    console.log('ê³µìœ  ì·¨ì†Œ ë˜ëŠ” ì‹¤íŒ¨:', err);
                });
            } else {
                // Web Share APIê°€ ì§€ì›ë˜ì§€ ì•Šìœ¼ë©´ í´ë¦½ë³´ë“œì— ë³µì‚¬
                copyReferralLink();
                alert('ê³µìœ  ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•Šì•„ ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.\nSNSì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”!');
            }
        }

        function showCreditUsageModal() {
            // í˜„ì¬ í¬ë ˆë”§ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const credits = parseInt(document.getElementById('referral-credits').textContent);
            if (credits <= 0) {
                alert('ì‚¬ìš© ê°€ëŠ¥í•œ í¬ë ˆë”§ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('credit-usage-modal').style.display = 'flex';
            document.getElementById('modal-credits').textContent = credits;
            
            // ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ
            loadAvailablePoliticiansForCredit();
            
            // í¼ ë¦¬ì…‹
            document.getElementById('credit-usage-form').reset();
            document.getElementById('credit-usage-status').innerHTML = '';
        }

        function closeCreditUsageModal() {
            document.getElementById('credit-usage-modal').style.display = 'none';
        }

        function loadAvailablePoliticiansForCredit() {
            const select = document.getElementById('credit-politician-select');
            select.innerHTML = '<option value="">ì •ì¹˜ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>';
            
            // ë“±ë¡ëœ ì •ì¹˜ì¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            fetch('/api/politicians/registered')
                .then(response => response.json())
                .then(data => {
                    select.innerHTML = '<option value="">ì •ì¹˜ì¸ì„ ì„ íƒí•˜ì„¸ìš”...</option>';
                    
                    // í˜„ì¬ ì‚¬ìš©ìê°€ ì´ë¯¸ ì„ íƒí•œ ì •ì¹˜ì¸ë“¤ ì œì™¸
                    const userProfile = getCurrentUserProfile();
                    const alreadySelected = userProfile ? userProfile.politicians : [];
                    
                    data.politicians.forEach(politician => {
                        if (!alreadySelected.includes(politician.name)) {
                            const option = document.createElement('option');
                            option.value = politician.name;
                            option.textContent = politician.name;
                            select.appendChild(option);
                        }
                    });
                    
                    if (select.children.length <= 1) {
                        select.innerHTML = '<option value="">ì„ íƒ ê°€ëŠ¥í•œ ì •ì¹˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤</option>';
                    }
                })
                .catch(error => {
                    console.error('ì •ì¹˜ì¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    select.innerHTML = '<option value="">ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
                });
        }

        function getCurrentUserProfile() {
            // í˜„ì¬ ë¡œë“œëœ ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ë°˜í™˜ (ì „ì—­ ë³€ìˆ˜ë‚˜ ìºì‹œì—ì„œ)
            // ì„ì‹œë¡œ null ë°˜í™˜ - ì‹¤ì œë¡œëŠ” ì‚¬ìš©ì í”„ë¡œí•„ ë°ì´í„°ë¥¼ ë°˜í™˜í•´ì•¼ í•¨
            return null;
        }

        // ì´ˆê¸° ì½”ì¸ ë°›ê¸° ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showClaimCoinsModal() {
            document.getElementById('claim-coins-modal').style.display = 'flex';
            document.getElementById('claim-coins-form').reset();
            document.getElementById('claim-coins-status').innerHTML = '';
        }

        function closeClaimCoinsModal() {
            document.getElementById('claim-coins-modal').style.display = 'none';
        }

        function processClaimCoins() {
            const pin = document.getElementById('claim-pin').value;
            const statusElem = document.getElementById('claim-coins-status');

            if (!pin || pin.length !== 6) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            statusElem.innerHTML = '<span style="color: #f39c12;">ì´ˆê¸° ì½”ì¸ ìš”ì²­ ì¤‘...</span>';

            const claimData = {
                pin: pin
            };

            fetch('/api/user/claim-initial-coins', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(claimData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
                return response.json();
            })
            .then(data => {
                statusElem.innerHTML = '<span style="color: #28a745;">âœ… ì´ˆê¸° ì½”ì¸ì„ ì„±ê³µì ìœ¼ë¡œ ë°›ì•˜ìŠµë‹ˆë‹¤!</span>';
                
                // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    closeClaimCoinsModal();
                    loadUserProfile(); // í”„ë¡œí•„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    showToast('ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ì´ˆê¸° ì½”ì¸ 300ê°œë¥¼ ë°›ì•˜ì–´ìš”!');
                }, 3000);
            })
            .catch(error => {
                console.error('ì´ˆê¸° ì½”ì¸ ìš”ì²­ ì‹¤íŒ¨:', error);
                statusElem.innerHTML = `<span style="color: #e74c3c;">ìš”ì²­ ì‹¤íŒ¨: ${error.message}</span>`;
            });
        }

        function processCreditUsage() {
            const politician = document.getElementById('credit-politician-select').value;
            const creditAmount = parseInt(document.getElementById('credit-amount').value);
            const pin = document.getElementById('credit-pin').value;
            const statusElem = document.getElementById('credit-usage-status');

            // ì…ë ¥ê°’ ê²€ì¦
            if (!politician) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">ì •ì¹˜ì¸ì„ ì„ íƒí•˜ì„¸ìš”.</span>';
                return;
            }

            if (!pin || pin.length !== 6) {
                statusElem.innerHTML = '<span style="color: #e74c3c;">6ìë¦¬ PINì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
                return;
            }

            statusElem.innerHTML = '<span style="color: #f39c12;">í¬ë ˆë”§ ì‚¬ìš© ì²˜ë¦¬ ì¤‘...</span>';

            const usageData = {
                politician: politician,
                credit_amount: creditAmount,
                pin: pin
            };

            fetch('/api/user/use-credit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(usageData)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
                return response.json();
            })
            .then(data => {
                statusElem.innerHTML = '<span style="color: #28a745;">âœ… í¬ë ˆë”§ ì‚¬ìš© ì™„ë£Œ! ì •ì¹˜ì¸ì´ ì¶”ê°€ë˜ê³  ì½”ì¸ 100ê°œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.</span>';
                
                // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    closeCreditUsageModal();
                    loadUserProfile(); // í”„ë¡œí•„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    showToast(`ğŸ‰ ${politician} ì •ì¹˜ì¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ì½”ì¸ 100ê°œë¥¼ ë°›ì•˜ì–´ìš”!`);
                }, 3000);
            })
            .catch(error => {
                console.error('í¬ë ˆë”§ ì‚¬ìš© ì‹¤íŒ¨:', error);
                statusElem.innerHTML = `<span style="color: #e74c3c;">í¬ë ˆë”§ ì‚¬ìš© ì‹¤íŒ¨: ${error.message}</span>`;
            });
        }

        function showToast(message) {
            // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìƒì„±
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: #28a745; color: white; 
                padding: 15px 20px; border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000; font-size: 14px; font-weight: 500;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            
            // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
            if (!document.getElementById('toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(toast);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

    </script>
</body>
</html>